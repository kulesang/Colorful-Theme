import{u as z,r as h,a as I,o as T,c as B,b as a,t as o,e as r,w as d,f,h as N,i as w,j as C,k,l as P,d as U,g as A,m as i}from"./index-K3BHgUgf.js";import{g as j,s as D,f as M}from"./auth-BWf5lCMM.js";import{C as G}from"./Captcha-BpJFZbxP.js";import{_ as L}from"./_plugin-vue_export-helper-CwKUxaPK.js";const H={class:"dark-tech-auth"},J={class:"auth-grid"},K={class:"branding-side"},O={class:"brand-content"},Q={class:"logo-container"},W={class:"brand-title"},X={class:"brand-desc"},Y={class:"features"},Z={class:"feature-badge"},x={class:"feature-badge"},ee={class:"form-side"},ae={class:"glass-card form-container"},se={class:"form-header"},te={class:"code-input-group"},oe={class:"form-footer"},re={href:"#/login",class:"link-primary"},le={__name:"ForgotPassword",setup(ie){const{t:l}=z(),_=A(),V=N(),v=h(!1),u=h({}),p=h(null),S=e=>{p.value=e},t=I({email:"",password:"",re_password:"",email_code:""}),c=h(0);let b=null;const q=async()=>{if(!t.email)return i.error(l("validation.emailRequired"));if(_.enableCaptcha&&p.value!==!0)return i.error(l("auth.enterCaptcha"));try{await D({email:t.email}),i.success(l("auth.codeSent")),c.value=60,b=setInterval(()=>{c.value--,c.value<=0&&clearInterval(b)},1e3)}catch(e){i.error(e.message||l("auth.sendFailed"))}};T(async()=>{try{const e=await j();e.data&&(u.value=e.data)}catch(e){console.error("Failed to fetch config:",e)}});const E=async(e,s)=>{if(!s)throw new Error("è¯·è¾“å…¥é‚®ç®±");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s))throw new Error("è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€");if(u.value.email_whitelist_suffix&&Array.isArray(u.value.email_whitelist_suffix)){const m=s.split("@")[1];if(!u.value.email_whitelist_suffix.includes(m))throw new Error(`ä»…æ”¯æŒä»¥ä¸‹é‚®ç®±åŽç¼€: ${u.value.email_whitelist_suffix.join(", ")}`)}},F=async e=>{if(_.enableCaptcha){if(p.value===null)return i.error(l("auth.enterCaptcha"));if(p.value===!1)return i.error(l("auth.captchaInvalid"))}if(e.password!==e.re_password)return i.error(l("validation.passwordMismatch"));v.value=!0;try{(await M(e)).data&&(i.success(l("auth.resetPasswordSuccess")),V.push("/login"))}catch{}finally{v.value=!1}};return(e,s)=>{const g=f("a-input"),m=f("a-form-item"),y=f("a-button"),$=f("a-input-password"),R=f("a-form");return w(),B("div",H,[a("div",J,[a("div",K,[a("div",O,[a("div",Q,[s[4]||(s[4]=a("div",{class:"logo-glow"},null,-1)),a("h1",W,o(e.$t("auth.forgotPasswordTitle")),1)]),a("p",X,o(e.$t("auth.brandDesc")),1),a("div",Y,[a("div",Z,[s[5]||(s[5]=a("div",{class:"badge-icon"},"ðŸ”’",-1)),a("span",null,o(e.$t("auth.secureVerification")),1)]),a("div",x,[s[6]||(s[6]=a("div",{class:"badge-icon"},"ðŸ“§",-1)),a("span",null,o(e.$t("auth.emailVerification")),1)])])])]),a("div",ee,[a("div",ae,[a("div",se,[a("h2",null,o(e.$t("auth.forgotPasswordTitle")),1),a("p",null,o(e.$t("auth.forgotPasswordSubtitle")),1)]),r(R,{model:t,onFinish:F,layout:"vertical"},{default:d(()=>[r(m,{label:e.$t("auth.email"),name:"email",rules:[{validator:E}]},{default:d(()=>[r(g,{value:t.email,"onUpdate:value":s[0]||(s[0]=n=>t.email=n),placeholder:"your@email.com",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),u.value.is_email_verify?(w(),C(m,{key:0,label:"é‚®ç®±éªŒè¯ç ",name:"email_code",rules:[{required:!0,message:"è¯·è¾“å…¥é‚®ç®±éªŒè¯ç "}],class:"code-item"},{default:d(()=>[a("div",te,[r(g,{value:t.email_code,"onUpdate:value":s[1]||(s[1]=n=>t.email_code=n),placeholder:"è¾“å…¥éªŒè¯ç ",size:"large"},null,8,["value"]),r(y,{type:"primary",class:"send-code-btn",disabled:c.value>0||!t.email,onClick:q},{default:d(()=>[P(o(c.value>0?`${c.value}s`:"å‘é€éªŒè¯ç "),1)]),_:1},8,["disabled"])])]),_:1})):k("",!0),r(m,{label:e.$t("auth.newPassword"),name:"password",rules:[{required:!0,message:e.$t("validation.passwordRequired")},{min:6,message:"å¯†ç è‡³å°‘6ä½"}]},{default:d(()=>[r($,{value:t.password,"onUpdate:value":s[2]||(s[2]=n=>t.password=n),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),r(m,{label:e.$t("auth.confirmPassword"),name:"re_password",rules:[{required:!0,message:e.$t("validation.passwordRequired")}]},{default:d(()=>[r($,{value:t.re_password,"onUpdate:value":s[3]||(s[3]=n=>t.re_password=n),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),U(_).enableCaptcha?(w(),C(G,{key:1,onVerify:S})):k("",!0),r(y,{type:"primary","html-type":"submit",loading:v.value,block:"",size:"large"},{default:d(()=>[P(o(e.$t("auth.resetPassword")),1)]),_:1},8,["loading"])]),_:1},8,["model"]),a("div",oe,[a("span",null,o(e.$t("auth.hasAccount")),1),a("a",re,o(e.$t("auth.backToLogin")),1)])])])])])}}},me=L(le,[["__scopeId","data-v-2f0ee77b"]]);export{me as default};
