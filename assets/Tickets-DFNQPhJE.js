import{u as E,b as u,f as H,h as d,i as e,n as c,k as n,j as p,t as a,F as M,x as N,l as P,w as S,o as i,z as T,p as U,C as $,D as C,a as G,q as f}from"./index-wd-hZkLN.js";import{u as J,v as K,w as O,x as Q,y as W}from"./user-DW6XJAw8.js";import{_ as X}from"./_plugin-vue_export-helper-_GT-bmI3.js";import{T as A}from"./ticket-C4KBOFPW.js";import{P as Y}from"./plus-DtZzIoXL.js";import{C as Z}from"./clock-Cwlx3ODb.js";import{c as x}from"./createLucideIcon-BcaHDl5-.js";import{S as B}from"./send-C_NN6cNf.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=x("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),se={class:"tickets-page"},te={class:"page-header"},ae={class:"header-icon"},le={class:"action-bar"},oe={key:0,class:"tickets-list"},ie=["onClick"],de={class:"ticket-header"},ce={class:"ticket-title-area"},ne={class:"ticket-title"},re={class:"ticket-id"},ue={class:"ticket-body"},ve={class:"ticket-preview"},pe={class:"ticket-meta"},me={class:"meta-item"},he={key:0,class:"meta-item"},ke={key:1,class:"loading-state"},_e={key:2,class:"empty-state"},be={class:"new-ticket-form"},ye={class:"form-group"},fe=["placeholder"],ge={class:"form-group"},we=["placeholder"],Te=["disabled"],$e={key:0,class:"ticket-detail"},Ce={class:"detail-header"},ze={class:"title-with-badge"},je={class:"message-thread"},De={key:0,class:"message-item me"},Ve={class:"message-bubble"},Me={class:"message-time"},Ne={key:0,class:"message-avatar"},Pe={class:"message-bubble"},Se={class:"message-time"},Ue={key:0,class:"reply-area"},Ae=["placeholder"],Be={class:"reply-actions"},Le=["disabled"],qe={__name:"Tickets",setup(Ie){const{t:v}=E(),g=u([]),_=u(!0),b=u(!1),h=u(!1),o=u(null),k=u(!1),m=u(""),r=u({subject:"",level:1,message:""});H(async()=>{await y()});const y=async()=>{try{const s=await J();s.data&&(g.value=s.data)}catch{}finally{_.value=!1}},z=s=>({0:v("dashboard.tickets.statusPending"),1:v("dashboard.tickets.statusClosed")})[s]||v("dashboard.tickets.statusUnknown"),j=s=>({0:"pending",1:"closed"})[s]||"",w=s=>s?new Date(s*1e3).toLocaleString("zh-CN"):"--",L=async()=>{if(!r.value.subject||!r.value.message){f.error(v("dashboard.tickets.fillComplete"));return}k.value=!0;try{await O(r.value),f.success(v("dashboard.tickets.submitted")),b.value=!1,r.value={subject:"",level:1,message:""},await y()}catch{}finally{k.value=!1}},q=async s=>{try{const l=await K({id:s.id});l.data&&(o.value=l.data,h.value=!0)}catch{}},I=async()=>{if(m.value)try{await W({id:o.value.id,message:m.value}),f.success(v("dashboard.tickets.replySent")),m.value="",h.value=!1,await y()}catch{}},F=async()=>{try{await Q({id:o.value.id}),f.success(v("dashboard.tickets.ticketClosed")),h.value=!1,await y()}catch{}};return(s,l)=>{var V;const R=P("a-spin"),D=P("a-modal");return i(),d("div",se,[e("div",te,[e("div",ae,[n(p(A),{size:32})]),e("h1",null,a(s.$t("dashboard.tickets.title")),1),e("p",null,a(s.$t("dashboard.tickets.description")),1)]),e("div",le,[e("button",{class:"new-ticket-btn",onClick:l[0]||(l[0]=t=>b.value=!0)},[n(p(Y),{size:18}),e("span",null,a(s.$t("dashboard.tickets.newTicket")),1)])]),_.value?c("",!0):(i(),d("div",oe,[(i(!0),d(M,null,N(g.value,t=>(i(),d("div",{key:t.id,class:"ticket-card glass-card",onClick:Fe=>q(t)},[e("div",de,[e("div",ce,[e("h3",ne,a(t.subject),1),e("span",{class:T(["ticket-status",j(t.status)])},a(z(t.status)),3)]),e("div",re,"#"+a(t.id),1)]),e("div",ue,[e("div",ve,a(typeof t.message=="string"?t.message.substring(0,100):"")+"...",1),e("div",pe,[e("span",me,[n(p(Z),{size:14}),U(" "+a(w(t.updated_at||t.created_at)),1)]),t.reply_count?(i(),d("span",he,[n(p(ee),{size:14}),U(" "+a(t.reply_count)+" "+a(s.$t("dashboard.tickets.replies")),1)])):c("",!0)])])],8,ie))),128))])),_.value?(i(),d("div",ke,[n(R,{size:"large"})])):c("",!0),!_.value&&g.value.length===0?(i(),d("div",_e,[l[6]||(l[6]=e("div",{class:"empty-icon"},"ðŸŽ«",-1)),e("p",null,a(s.$t("dashboard.tickets.noTickets")),1)])):c("",!0),n(D,{open:b.value,"onUpdate:open":l[3]||(l[3]=t=>b.value=t),title:s.$t("dashboard.tickets.createTitle"),footer:null,centered:"",class:"ticket-modal"},{default:S(()=>[e("div",be,[e("div",ye,[e("label",null,a(s.$t("dashboard.tickets.ticketTitle")),1),$(e("input",{"onUpdate:modelValue":l[1]||(l[1]=t=>r.value.subject=t),placeholder:s.$t("dashboard.tickets.titlePlaceholder"),class:"form-input"},null,8,fe),[[C,r.value.subject]])]),e("div",ge,[e("label",null,a(s.$t("dashboard.tickets.problemDescription")),1),$(e("textarea",{"onUpdate:modelValue":l[2]||(l[2]=t=>r.value.message=t),placeholder:s.$t("dashboard.tickets.descriptionPlaceholder"),class:"form-textarea"},null,8,we),[[C,r.value.message]])]),e("button",{class:"submit-btn",onClick:L,disabled:k.value},[k.value?c("",!0):(i(),G(p(B),{key:0,size:18})),e("span",null,a(k.value?s.$t("dashboard.tickets.submitting"):s.$t("dashboard.tickets.submit")),1)],8,Te)])]),_:1},8,["open","title"]),n(D,{open:h.value,"onUpdate:open":l[5]||(l[5]=t=>h.value=t),title:"#"+((V=o.value)==null?void 0:V.id)+" "+s.$t("dashboard.tickets.detailTitle"),footer:null,width:700,centered:"",class:"ticket-modal"},{default:S(()=>[o.value?(i(),d("div",$e,[e("div",Ce,[e("div",ze,[e("span",{class:T(["ticket-status",j(o.value.status)])},a(z(o.value.status)),3),e("h3",null,a(o.value.subject),1)])]),e("div",je,[o.value.message&&!Array.isArray(o.value.message)?(i(),d("div",De,[e("div",Ve,[e("p",null,a(o.value.message),1),e("span",Me,a(w(o.value.created_at)),1)])])):c("",!0),Array.isArray(o.value.message)?(i(!0),d(M,{key:1},N(o.value.message,t=>(i(),d("div",{key:t.id,class:T(["message-item",t.is_me?"me":"staff"])},[t.is_me?c("",!0):(i(),d("div",Ne,[n(p(A),{size:16})])),e("div",Pe,[e("p",null,a(t.message),1),e("span",Se,a(w(t.created_at)),1)])],2))),128)):c("",!0)]),o.value.status!==1?(i(),d("div",Ue,[$(e("textarea",{"onUpdate:modelValue":l[4]||(l[4]=t=>m.value=t),placeholder:s.$t("dashboard.tickets.replyPlaceholder"),class:"reply-textarea"},null,8,Ae),[[C,m.value]]),e("div",Be,[o.value.status===0?(i(),d("button",{key:0,class:"close-ticket-btn-text",onClick:F},a(s.$t("dashboard.tickets.closeTicket")),1)):c("",!0),e("button",{class:"submit-reply-btn",onClick:I,disabled:!m.value},[n(p(B),{size:16}),e("span",null,a(s.$t("dashboard.tickets.sendReply")),1)],8,Le)])])):c("",!0)])):c("",!0)]),_:1},8,["open","title"])])}}},We=X(qe,[["__scopeId","data-v-92ebd4fd"]]);export{We as default};
