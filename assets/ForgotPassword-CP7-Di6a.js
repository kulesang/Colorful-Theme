import{b as N,u as j,e as c,f as D,h as L,c as M,x as G,i as k,j as s,t as i,l as r,w as n,m as f,n as W,o as m,a as g,p as A,F as H,y as J,q as P,k as K,g as O,s as d}from"./index-CUYkGM1Q.js";import{g as Q,s as X,f as Y}from"./auth-BGQtx82I.js";import{C as Z}from"./Captcha-BcEKHLrJ.js";import"./request-CrJ_HLQ3.js";const ee={class:"dark-tech-auth"},ae={class:"auth-grid"},se={class:"branding-side"},te={class:"brand-content"},le={class:"logo-container"},oe={class:"brand-title"},ie={class:"brand-desc"},re={class:"features"},ne={class:"feature-badge"},ue={class:"feature-badge"},de={class:"form-side"},ce={class:"glass-card form-container"},fe={class:"form-header"},me={key:0,class:"email-whitelist-input"},ve={class:"code-input-group"},_e={class:"form-footer"},pe={href:"#/login",class:"link-primary"},he={__name:"ForgotPassword",setup(we){const{t:u}=j(),y=O(),E=W(),b=c(!1),l=c({}),p=c(null),R=e=>{p.value=e},o=D({email:"",password:"",re_password:"",email_code:""}),v=c(0),V=c(!1);let x=null;const U=async()=>{if(!o.email)return d.error(u("validation.emailRequired"));if(y.enableCaptcha&&p.value!==!0)return d.error(u("auth.enterCaptcha"));try{V.value=!0,await X({email:o.email}),d.success(u("auth.codeSent")),v.value=60,x=setInterval(()=>{v.value--,v.value<=0&&clearInterval(x)},1e3)}catch(e){d.error(e.message||u("auth.sendFailed"))}finally{V.value=!1}};L(async()=>{try{const e=await Q();e.data&&(l.value=e.data,l.value.email_whitelist_suffix&&l.value.email_whitelist_suffix.length>0&&(_.value=l.value.email_whitelist_suffix[0]))}catch(e){console.error("Failed to fetch config:",e)}});const F=M(()=>l.value.email_whitelist_suffix&&Array.isArray(l.value.email_whitelist_suffix)&&l.value.email_whitelist_suffix.length>0),h=c(""),_=c("");G([h,_],()=>{F.value&&(o.email=`${h.value}@${_.value}`)});const I=async(e,a)=>{if(!a)throw new Error("è¯·è¾“å…¥é‚®ç®±");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))throw new Error("è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€");if(l.value.email_whitelist_suffix&&Array.isArray(l.value.email_whitelist_suffix)){const $=a.split("@")[1];if(!l.value.email_whitelist_suffix.includes($))throw new Error(`ä»…æ”¯æŒä»¥ä¸‹é‚®ç®±åŽç¼€: ${l.value.email_whitelist_suffix.join(", ")}`)}},T=async e=>{if(y.enableCaptcha){if(p.value===null)return d.error(u("auth.enterCaptcha"));if(p.value===!1)return d.error(u("auth.captchaInvalid"))}if(e.password!==e.re_password)return d.error(u("validation.passwordMismatch"));b.value=!0;try{(await Y(e)).data&&(d.success(u("auth.resetPasswordSuccess")),E.push("/login"))}catch{}finally{b.value=!1}};return(e,a)=>{const S=f("a-select-option"),$=f("a-select"),C=f("a-input"),w=f("a-form-item"),q=f("a-button"),z=f("a-input-password"),B=f("a-form");return m(),k("div",ee,[s("div",ae,[s("div",se,[s("div",te,[s("div",le,[a[6]||(a[6]=s("div",{class:"logo-glow"},null,-1)),s("h1",oe,i(e.$t("auth.forgotPasswordTitle")),1)]),s("p",ie,i(e.$t("auth.brandDesc")),1),s("div",re,[s("div",ne,[a[7]||(a[7]=s("div",{class:"badge-icon"},"ðŸ”’",-1)),s("span",null,i(e.$t("auth.secureVerification")),1)]),s("div",ue,[a[8]||(a[8]=s("div",{class:"badge-icon"},"ðŸ“§",-1)),s("span",null,i(e.$t("auth.emailVerification")),1)])])])]),s("div",de,[s("div",ce,[s("div",fe,[s("h2",null,i(e.$t("auth.forgotPasswordTitle")),1),s("p",null,i(e.$t("auth.forgotPasswordSubtitle")),1)]),r(B,{model:o,onFinish:T,layout:"vertical"},{default:n(()=>[r(w,{label:e.$t("auth.email"),name:"email",rules:[{validator:I}]},{default:n(()=>[F.value?(m(),k("div",me,[r(C,{value:h.value,"onUpdate:value":a[1]||(a[1]=t=>h.value=t),placeholder:"example",size:"large"},{addonAfter:n(()=>[r($,{value:_.value,"onUpdate:value":a[0]||(a[0]=t=>_.value=t),class:"suffix-select"},{default:n(()=>[(m(!0),k(H,null,J(l.value.email_whitelist_suffix,t=>(m(),g(S,{key:t,value:t},{default:n(()=>[P(" @"+i(t),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["value"])])):(m(),g(C,{key:1,value:o.email,"onUpdate:value":a[2]||(a[2]=t=>o.email=t),placeholder:"your@email.com",size:"large"},null,8,["value"]))]),_:1},8,["label","rules"]),l.value.is_email_verify?(m(),g(w,{key:0,label:"é‚®ç®±éªŒè¯ç ",name:"email_code",rules:[{required:!0,message:"è¯·è¾“å…¥é‚®ç®±éªŒè¯ç "}],class:"code-item"},{default:n(()=>[s("div",ve,[r(C,{value:o.email_code,"onUpdate:value":a[3]||(a[3]=t=>o.email_code=t),placeholder:"è¾“å…¥éªŒè¯ç ",size:"large"},null,8,["value"]),r(q,{type:"primary",class:"send-code-btn",disabled:v.value>0||!o.email,onClick:U},{default:n(()=>[P(i(v.value>0?`${v.value}s`:"å‘é€éªŒè¯ç "),1)]),_:1},8,["disabled"])])]),_:1})):A("",!0),r(w,{label:e.$t("auth.newPassword"),name:"password",rules:[{required:!0,message:e.$t("validation.passwordRequired")},{min:6,message:"å¯†ç è‡³å°‘6ä½"}]},{default:n(()=>[r(z,{value:o.password,"onUpdate:value":a[4]||(a[4]=t=>o.password=t),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),r(w,{label:e.$t("auth.confirmPassword"),name:"re_password",rules:[{required:!0,message:e.$t("validation.passwordRequired")}]},{default:n(()=>[r(z,{value:o.re_password,"onUpdate:value":a[5]||(a[5]=t=>o.re_password=t),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),K(y).enableCaptcha?(m(),g(Z,{key:1,onVerify:R})):A("",!0),r(q,{type:"primary","html-type":"submit",loading:b.value,block:"",size:"large"},{default:n(()=>[P(i(e.$t("auth.resetPassword")),1)]),_:1},8,["loading"])]),_:1},8,["model"]),s("div",_e,[s("span",null,i(e.$t("auth.hasAccount")),1),s("a",pe,i(e.$t("auth.backToLogin")),1)])])])])])}}},Ce=N(he,[["__scopeId","data-v-f9aa5e8b"]]);export{Ce as default};
