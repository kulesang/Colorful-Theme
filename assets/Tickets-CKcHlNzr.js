import{b as E,u as G,e as u,h as H,i as d,j as e,p as c,l as n,k as p,t as a,F as V,y as B,m as N,w as P,o as i,B as T,q as S,D as J,M as K,G as $,I as C,a as O,S as U,s as g}from"./index-DHUON-5F.js";import{z as Q,A as W,B as X,C as Y,D as Z}from"./user-CGpMpWfC.js";import{T as A}from"./ticket-CFODKTO7.js";import{P as x}from"./plus-BVcqCUSV.js";import"./request-CTahc_yj.js";const ee={class:"tickets-page"},se={class:"page-header"},te={class:"header-icon"},ae={class:"action-bar"},le={key:0,class:"tickets-list"},oe=["onClick"],ie={class:"ticket-header"},de={class:"ticket-title-area"},ce={class:"ticket-title"},ne={class:"ticket-id"},re={class:"ticket-body"},ue={class:"ticket-preview"},ve={class:"ticket-meta"},pe={class:"meta-item"},he={key:0,class:"meta-item"},me={key:1,class:"loading-state"},ke={key:2,class:"empty-state"},_e={class:"new-ticket-form"},be={class:"form-group"},ye=["placeholder"],ge={class:"form-group"},fe=["placeholder"],we=["disabled"],Te={key:0,class:"ticket-detail"},$e={class:"detail-header"},Ce={class:"title-with-badge"},ze={class:"message-thread"},De={key:0,class:"message-item me"},je={class:"message-bubble"},Me={class:"message-time"},Ve={key:0,class:"message-avatar"},Be={class:"message-bubble"},Ne={class:"message-time"},Pe={key:0,class:"reply-area"},Se=["placeholder"],Ue={class:"reply-actions"},Ae=["disabled"],Ie={__name:"Tickets",setup(Le){const{t:v}=G(),f=u([]),_=u(!0),b=u(!1),m=u(!1),o=u(null),k=u(!1),h=u(""),r=u({subject:"",level:1,message:""});H(async()=>{await y()});const y=async()=>{try{const s=await Q();s.data&&(f.value=s.data)}catch{}finally{_.value=!1}},z=s=>({0:v("dashboard.tickets.statusPending"),1:v("dashboard.tickets.statusClosed")})[s]||v("dashboard.tickets.statusUnknown"),D=s=>({0:"pending",1:"closed"})[s]||"",w=s=>s?new Date(s*1e3).toLocaleString("zh-CN"):"--",I=async()=>{if(!r.value.subject||!r.value.message){g.error(v("dashboard.tickets.fillComplete"));return}k.value=!0;try{await X(r.value),g.success(v("dashboard.tickets.submitted")),b.value=!1,r.value={subject:"",level:1,message:""},await y()}catch{}finally{k.value=!1}},L=async s=>{try{const l=await W({id:s.id});l.data&&(o.value=l.data,m.value=!0)}catch{}},q=async()=>{if(h.value)try{await Z({id:o.value.id,message:h.value}),g.success(v("dashboard.tickets.replySent")),h.value="",m.value=!1,await y()}catch{}},F=async()=>{try{await Y({id:o.value.id}),g.success(v("dashboard.tickets.ticketClosed")),m.value=!1,await y()}catch{}};return(s,l)=>{var M;const R=N("a-spin"),j=N("a-modal");return i(),d("div",ee,[e("div",se,[e("div",te,[n(p(A),{size:32})]),e("h1",null,a(s.$t("dashboard.tickets.title")),1),e("p",null,a(s.$t("dashboard.tickets.description")),1)]),e("div",ae,[e("button",{class:"new-ticket-btn",onClick:l[0]||(l[0]=t=>b.value=!0)},[n(p(x),{size:18}),e("span",null,a(s.$t("dashboard.tickets.newTicket")),1)])]),_.value?c("",!0):(i(),d("div",le,[(i(!0),d(V,null,B(f.value,t=>(i(),d("div",{key:t.id,class:"ticket-card glass-card",onClick:qe=>L(t)},[e("div",ie,[e("div",de,[e("h3",ce,a(t.subject),1),e("span",{class:T(["ticket-status",D(t.status)])},a(z(t.status)),3)]),e("div",ne,"#"+a(t.id),1)]),e("div",re,[e("div",ue,a(typeof t.message=="string"?t.message.substring(0,100):"")+"...",1),e("div",ve,[e("span",pe,[n(p(J),{size:14}),S(" "+a(w(t.updated_at||t.created_at)),1)]),t.reply_count?(i(),d("span",he,[n(p(K),{size:14}),S(" "+a(t.reply_count)+" "+a(s.$t("dashboard.tickets.replies")),1)])):c("",!0)])])],8,oe))),128))])),_.value?(i(),d("div",me,[n(R,{size:"large"})])):c("",!0),!_.value&&f.value.length===0?(i(),d("div",ke,[l[6]||(l[6]=e("div",{class:"empty-icon"},"ðŸŽ«",-1)),e("p",null,a(s.$t("dashboard.tickets.noTickets")),1)])):c("",!0),n(j,{open:b.value,"onUpdate:open":l[3]||(l[3]=t=>b.value=t),title:s.$t("dashboard.tickets.createTitle"),footer:null,centered:"",class:"ticket-modal"},{default:P(()=>[e("div",_e,[e("div",be,[e("label",null,a(s.$t("dashboard.tickets.ticketTitle")),1),$(e("input",{"onUpdate:modelValue":l[1]||(l[1]=t=>r.value.subject=t),placeholder:s.$t("dashboard.tickets.titlePlaceholder"),class:"form-input"},null,8,ye),[[C,r.value.subject]])]),e("div",ge,[e("label",null,a(s.$t("dashboard.tickets.problemDescription")),1),$(e("textarea",{"onUpdate:modelValue":l[2]||(l[2]=t=>r.value.message=t),placeholder:s.$t("dashboard.tickets.descriptionPlaceholder"),class:"form-textarea"},null,8,fe),[[C,r.value.message]])]),e("button",{class:"submit-btn",onClick:I,disabled:k.value},[k.value?c("",!0):(i(),O(p(U),{key:0,size:18})),e("span",null,a(k.value?s.$t("dashboard.tickets.submitting"):s.$t("dashboard.tickets.submit")),1)],8,we)])]),_:1},8,["open","title"]),n(j,{open:m.value,"onUpdate:open":l[5]||(l[5]=t=>m.value=t),title:"#"+((M=o.value)==null?void 0:M.id)+" "+s.$t("dashboard.tickets.detailTitle"),footer:null,width:700,centered:"",class:"ticket-modal"},{default:P(()=>[o.value?(i(),d("div",Te,[e("div",$e,[e("div",Ce,[e("span",{class:T(["ticket-status",D(o.value.status)])},a(z(o.value.status)),3),e("h3",null,a(o.value.subject),1)])]),e("div",ze,[o.value.message&&!Array.isArray(o.value.message)?(i(),d("div",De,[e("div",je,[e("p",null,a(o.value.message),1),e("span",Me,a(w(o.value.created_at)),1)])])):c("",!0),Array.isArray(o.value.message)?(i(!0),d(V,{key:1},B(o.value.message,t=>(i(),d("div",{key:t.id,class:T(["message-item",t.is_me?"me":"staff"])},[t.is_me?c("",!0):(i(),d("div",Ve,[n(p(A),{size:16})])),e("div",Be,[e("p",null,a(t.message),1),e("span",Ne,a(w(t.created_at)),1)])],2))),128)):c("",!0)]),o.value.status!==1?(i(),d("div",Pe,[$(e("textarea",{"onUpdate:modelValue":l[4]||(l[4]=t=>h.value=t),placeholder:s.$t("dashboard.tickets.replyPlaceholder"),class:"reply-textarea"},null,8,Se),[[C,h.value]]),e("div",Ue,[o.value.status===0?(i(),d("button",{key:0,class:"close-ticket-btn-text",onClick:F},a(s.$t("dashboard.tickets.closeTicket")),1)):c("",!0),e("button",{class:"submit-reply-btn",onClick:q,disabled:!h.value},[n(p(U),{size:16}),e("span",null,a(s.$t("dashboard.tickets.sendReply")),1)],8,Ae)])])):c("",!0)])):c("",!0)]),_:1},8,["open","title"])])}}},Je=E(Ie,[["__scopeId","data-v-92ebd4fd"]]);export{Je as default};
