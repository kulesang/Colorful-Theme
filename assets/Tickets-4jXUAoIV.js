import{u as E,r as u,o as H,c as d,b as e,k as c,e as r,d as m,t as a,F as M,x as N,f as P,w as S,i as o,y as T,l as U,B as $,C,j as G,m as f}from"./index-DBj0bk-v.js";import{r as J,t as K,u as O,v as Q,w as W}from"./user-DXsAa-Hk.js";import{_ as X}from"./_plugin-vue_export-helper-tGYcrXWe.js";import{T as A}from"./ticket-DlaoiQmn.js";import{P as Y}from"./plus-CUSbnajV.js";import{C as Z}from"./clock-B9B0HovO.js";import{c as x}from"./createLucideIcon-CI9fqIqV.js";import{S as B}from"./send-BlSp8qsX.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=x("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),se={class:"tickets-page"},te={class:"page-header"},ae={class:"header-icon"},le={class:"action-bar"},ie={key:0,class:"tickets-list"},oe=["onClick"],de={class:"ticket-header"},ce={class:"ticket-title-area"},re={class:"ticket-title"},ne={class:"ticket-id"},ue={class:"ticket-body"},ve={class:"ticket-preview"},me={class:"ticket-meta"},pe={class:"meta-item"},he={key:0,class:"meta-item"},ke={key:1,class:"loading-state"},_e={key:2,class:"empty-state"},be={class:"new-ticket-form"},ye={class:"form-group"},fe=["placeholder"],ge={class:"form-group"},we=["placeholder"],Te=["disabled"],$e={key:0,class:"ticket-detail"},Ce={class:"detail-header"},ze={class:"title-with-badge"},je={class:"message-thread"},Ve={key:0,class:"message-item me"},De={class:"message-bubble"},Me={class:"message-time"},Ne={key:0,class:"message-avatar"},Pe={class:"message-bubble"},Se={class:"message-time"},Ue={key:0,class:"reply-area"},Ae=["placeholder"],Be={class:"reply-actions"},Le=["disabled"],Ie={__name:"Tickets",setup(qe){const{t:v}=E(),g=u([]),_=u(!0),b=u(!1),h=u(!1),i=u(null),k=u(!1),p=u(""),n=u({subject:"",level:1,message:""});H(async()=>{await y()});const y=async()=>{try{const s=await J();s.data&&(g.value=s.data)}catch{}finally{_.value=!1}},z=s=>({0:v("dashboard.tickets.statusPending"),1:v("dashboard.tickets.statusClosed")})[s]||v("dashboard.tickets.statusUnknown"),j=s=>({0:"pending",1:"closed"})[s]||"",w=s=>s?new Date(s*1e3).toLocaleString("zh-CN"):"--",L=async()=>{if(!n.value.subject||!n.value.message){f.error(v("dashboard.tickets.fillComplete"));return}k.value=!0;try{await O(n.value),f.success(v("dashboard.tickets.submitted")),b.value=!1,n.value={subject:"",level:1,message:""},await y()}catch{}finally{k.value=!1}},I=async s=>{try{const l=await K({id:s.id});l.data&&(i.value=l.data,h.value=!0)}catch{}},q=async()=>{if(p.value)try{await W({id:i.value.id,message:p.value}),f.success(v("dashboard.tickets.replySent")),p.value="",h.value=!1,await y()}catch{}},F=async()=>{try{await Q({id:i.value.id}),f.success(v("dashboard.tickets.ticketClosed")),h.value=!1,await y()}catch{}};return(s,l)=>{var D;const R=P("a-spin"),V=P("a-modal");return o(),d("div",se,[e("div",te,[e("div",ae,[r(m(A),{size:32})]),e("h1",null,a(s.$t("dashboard.tickets.title")),1),e("p",null,a(s.$t("dashboard.tickets.description")),1)]),e("div",le,[e("button",{class:"new-ticket-btn",onClick:l[0]||(l[0]=t=>b.value=!0)},[r(m(Y),{size:18}),e("span",null,a(s.$t("dashboard.tickets.newTicket")),1)])]),_.value?c("",!0):(o(),d("div",ie,[(o(!0),d(M,null,N(g.value,t=>(o(),d("div",{key:t.id,class:"ticket-card glass-card",onClick:Fe=>I(t)},[e("div",de,[e("div",ce,[e("h3",re,a(t.subject),1),e("span",{class:T(["ticket-status",j(t.status)])},a(z(t.status)),3)]),e("div",ne,"#"+a(t.id),1)]),e("div",ue,[e("div",ve,a(typeof t.message=="string"?t.message.substring(0,100):"")+"...",1),e("div",me,[e("span",pe,[r(m(Z),{size:14}),U(" "+a(w(t.updated_at||t.created_at)),1)]),t.reply_count?(o(),d("span",he,[r(m(ee),{size:14}),U(" "+a(t.reply_count)+" "+a(s.$t("dashboard.tickets.replies")),1)])):c("",!0)])])],8,oe))),128))])),_.value?(o(),d("div",ke,[r(R,{size:"large"})])):c("",!0),!_.value&&g.value.length===0?(o(),d("div",_e,[l[6]||(l[6]=e("div",{class:"empty-icon"},"ðŸŽ«",-1)),e("p",null,a(s.$t("dashboard.tickets.noTickets")),1)])):c("",!0),r(V,{visible:b.value,"onUpdate:visible":l[3]||(l[3]=t=>b.value=t),title:s.$t("dashboard.tickets.createTitle"),footer:null,centered:"",class:"ticket-modal"},{default:S(()=>[e("div",be,[e("div",ye,[e("label",null,a(s.$t("dashboard.tickets.ticketTitle")),1),$(e("input",{"onUpdate:modelValue":l[1]||(l[1]=t=>n.value.subject=t),placeholder:s.$t("dashboard.tickets.titlePlaceholder"),class:"form-input"},null,8,fe),[[C,n.value.subject]])]),e("div",ge,[e("label",null,a(s.$t("dashboard.tickets.problemDescription")),1),$(e("textarea",{"onUpdate:modelValue":l[2]||(l[2]=t=>n.value.message=t),placeholder:s.$t("dashboard.tickets.descriptionPlaceholder"),class:"form-textarea"},null,8,we),[[C,n.value.message]])]),e("button",{class:"submit-btn",onClick:L,disabled:k.value},[k.value?c("",!0):(o(),G(m(B),{key:0,size:18})),e("span",null,a(k.value?s.$t("dashboard.tickets.submitting"):s.$t("dashboard.tickets.submit")),1)],8,Te)])]),_:1},8,["visible","title"]),r(V,{visible:h.value,"onUpdate:visible":l[5]||(l[5]=t=>h.value=t),title:"#"+((D=i.value)==null?void 0:D.id)+" "+s.$t("dashboard.tickets.detailTitle"),footer:null,width:700,centered:"",class:"ticket-modal"},{default:S(()=>[i.value?(o(),d("div",$e,[e("div",Ce,[e("div",ze,[e("span",{class:T(["ticket-status",j(i.value.status)])},a(z(i.value.status)),3),e("h3",null,a(i.value.subject),1)])]),e("div",je,[i.value.message&&!Array.isArray(i.value.message)?(o(),d("div",Ve,[e("div",De,[e("p",null,a(i.value.message),1),e("span",Me,a(w(i.value.created_at)),1)])])):c("",!0),Array.isArray(i.value.message)?(o(!0),d(M,{key:1},N(i.value.message,t=>(o(),d("div",{key:t.id,class:T(["message-item",t.is_me?"me":"staff"])},[t.is_me?c("",!0):(o(),d("div",Ne,[r(m(A),{size:16})])),e("div",Pe,[e("p",null,a(t.message),1),e("span",Se,a(w(t.created_at)),1)])],2))),128)):c("",!0)]),i.value.status!==1?(o(),d("div",Ue,[$(e("textarea",{"onUpdate:modelValue":l[4]||(l[4]=t=>p.value=t),placeholder:s.$t("dashboard.tickets.replyPlaceholder"),class:"reply-textarea"},null,8,Ae),[[C,p.value]]),e("div",Be,[i.value.status===0?(o(),d("button",{key:0,class:"close-ticket-btn-text",onClick:F},a(s.$t("dashboard.tickets.closeTicket")),1)):c("",!0),e("button",{class:"submit-reply-btn",onClick:q,disabled:!p.value},[r(m(B),{size:16}),e("span",null,a(s.$t("dashboard.tickets.sendReply")),1)],8,Le)])])):c("",!0)])):c("",!0)]),_:1},8,["visible","title"])])}}},We=X(Ie,[["__scopeId","data-v-d36835fe"]]);export{We as default};
