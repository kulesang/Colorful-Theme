import{b as V,u as q,e as u,c as C,h as E,v as M,x as b,i as o,j as s,p as v,l as d,k as _,t as l,F as O,y as T,m as z,w as D,o as n,q as j,E as I}from"./index-DHUON-5F.js";import{e as N,f as S}from"./user-CGpMpWfC.js";import{d as F}from"./marked.esm-DajSjiQI.js";import{B as L}from"./book-open-QiXkl1kU.js";import{F as x}from"./file-text-EYdIbI2Y.js";import{C as H}from"./calendar-D4JUhNI5.js";import"./request-CTahc_yj.js";const R={class:"knowledge-page"},U={class:"page-header"},G={class:"header-icon"},J={key:0,class:"knowledge-grid"},P=["onClick"],Q={class:"card-icon"},W={class:"card-content"},X={class:"card-title"},Y={key:0,class:"card-desc"},Z={class:"card-meta"},ee={class:"meta-item"},te={key:0,class:"category-tag"},ae={class:"card-arrow"},se={key:1,class:"loading-state"},oe={key:2,class:"empty-state"},ne={class:"modal-title"},le={class:"modal-content markdown-body"},de={key:0,class:"detail-loading"},re=["innerHTML"],ie={key:2,class:"empty-detail"},ce={__name:"Knowledge",setup(ue){const{locale:k}=q(),g=M();F.setOptions({breaks:!0,gfm:!0,headerIds:!0,mangle:!1});const h=u({}),i=u(!0),f=u(!1),m=u(!1),r=u(null),c=C(()=>{const e=[];return Object.keys(h.value).forEach(t=>{Array.isArray(h.value[t])&&h.value[t].forEach(p=>{e.push({...p,category:t})})}),e});E(async()=>{await $(),y()});const $=async()=>{try{i.value=!0;let e=await N({language:k.value==="zh-CN"?"zh-CN":"en"});(!e.data||Object.keys(e.data).length===0)&&(e=await N()),e.data&&(h.value=e.data)}catch(e){console.error("Fetch knowledge failed:",e)}finally{i.value=!1}},y=()=>{if(g.query.id&&c.value.length>0){const e=c.value.find(t=>t.id==g.query.id);e&&w(e)}};b(()=>g.query.id,()=>{y()}),b(()=>c.value,e=>{e.length>0&&y()});const A=e=>e?new Date(e*1e3).toLocaleDateString(k.value==="zh-CN"?"zh-CN":"en-US"):"--",B=C(()=>{var e;if(!((e=r.value)!=null&&e.body))return"";try{return F.parse(r.value.body)}catch(t){return console.error("Markdown parsing error:",t),r.value.body}}),w=async e=>{r.value={...e},f.value=!0,m.value=!0;try{const t=await S({id:e.id});t.data&&(r.value=t.data)}catch(t){console.error("Fetch article detail failed:",t)}finally{m.value=!1}};return(e,t)=>{const p=z("a-spin"),K=z("a-modal");return n(),o("div",R,[s("div",U,[s("div",G,[d(_(L),{size:32})]),s("h1",null,l(e.$t("dashboard.knowledge.title")),1),s("p",null,l(e.$t("dashboard.knowledge.description")),1)]),i.value?v("",!0):(n(),o("div",J,[(n(!0),o(O,null,T(c.value,a=>(n(),o("div",{key:a.id,class:"knowledge-card glass-card",onClick:ve=>w(a)},[s("div",Q,[d(_(x),{size:24})]),s("div",W,[s("h3",X,l(a.title),1),a.description?(n(),o("p",Y,l(a.description),1)):v("",!0),s("div",Z,[s("span",ee,[d(_(H),{size:14}),j(" "+l(A(a.updated_at||a.created_at)),1)]),a.category?(n(),o("span",te,l(a.category),1)):v("",!0)])]),s("div",ae,[d(_(I),{size:20})])],8,P))),128))])),i.value?(n(),o("div",se,[d(p,{size:"large"})])):v("",!0),!i.value&&c.value.length===0?(n(),o("div",oe,[t[1]||(t[1]=s("div",{class:"empty-icon"},"ðŸ“š",-1)),s("p",null,l(e.$t("dashboard.knowledge.noContent")),1)])):v("",!0),d(K,{open:f.value,"onUpdate:open":t[0]||(t[0]=a=>f.value=a),footer:null,width:800,centered:"",class:"knowledge-modal"},{title:D(()=>{var a;return[s("div",ne,[d(_(L),{size:20}),s("span",null,l((a=r.value)==null?void 0:a.title),1)])]}),default:D(()=>{var a;return[s("div",le,[m.value?(n(),o("div",de,[d(p),s("p",null,l(e.$t("common.loading")),1)])):(a=r.value)!=null&&a.body?(n(),o("div",{key:1,innerHTML:B.value},null,8,re)):(n(),o("div",ie,l(e.$t("dashboard.knowledge.noContent")),1))])]}),_:1},8,["open"])])}}},ke=V(ce,[["__scopeId","data-v-65fd7587"]]);export{ke as default};
