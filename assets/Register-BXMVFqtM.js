import{u as P,r as y,a as T,o as F,h as x,c as C,b as t,d as g,g as J,t as n,e as o,w as u,f as _,i as v,j as I,k as N,l as S,m}from"./index-DBj0bk-v.js";import{g as O,s as j,r as L,l as M}from"./auth-C5EpjEu2.js";import{g as D,a as G,b as H}from"./user-DXsAa-Hk.js";import{C as K}from"./Captcha-BtvPMyn8.js";import{_ as Q}from"./_plugin-vue_export-helper-tGYcrXWe.js";const W={class:"dark-tech-auth"},X={class:"auth-grid"},Y={class:"branding-side"},Z={class:"brand-content"},ee={class:"logo-container"},ae=["src","alt"],te={key:1,class:"brand-title"},se={class:"brand-desc"},oe={class:"features"},re={class:"feature-badge"},le={class:"feature-badge"},ie={class:"form-side"},ne={class:"glass-card form-container"},de={class:"form-header"},ue={class:"code-input-group"},ce={class:"form-footer"},me={href:"#/login",class:"link-primary"},fe={__name:"Register",setup(pe){const{t:d}=P(),f=J(),b=x(),k=y(!1),p=y({}),w=y(null),U=e=>{w.value=e},s=T({email:"",password:"",re_password:"",email_code:"",invite_code:"",agreement:!0}),h=y(0);let $=null;const q=async()=>{if(!s.email)return m.error(d("validation.emailRequired"));if(f.enableCaptcha&&w.value!==!0)return m.error(d("auth.enterCaptcha"));try{await j({email:s.email}),m.success(d("auth.codeSent")),h.value=60,$=setInterval(()=>{h.value--,h.value<=0&&clearInterval($)},1e3)}catch(e){m.error(e.message||d("auth.sendFailed"))}};F(async()=>{const e=b.currentRoute.value.query.code||b.currentRoute.value.query.invite_code;e&&(s.invite_code=e);try{const a=await O();a.data&&(p.value=a.data)}catch(a){console.error("Failed to fetch config:",a)}});const E=async(e,a)=>{if(!a)throw new Error("è¯·æŽ¥å—æœåŠ¡æ¡æ¬¾")},V=async(e,a)=>{if(!a)throw new Error("è¯·è¾“å…¥é‚®ç®±");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))throw new Error(d("validation.emailInvalid"));if(p.value.email_whitelist_suffix&&Array.isArray(p.value.email_whitelist_suffix)){const l=a.split("@")[1];if(!p.value.email_whitelist_suffix.includes(l))throw new Error(d("validation.emailSuffixNotAllowed",{suffixes:p.value.email_whitelist_suffix.join(", ")}))}},z=async e=>{if(f.enableCaptcha){if(w.value===null)return m.error(d("auth.enterCaptcha"));if(w.value===!1)return m.error(d("auth.captchaInvalid"))}if(e.password!==e.re_password)return m.error(d("validation.passwordMismatch"));k.value=!0;try{if((await L(e)).data){m.success(d("auth.registerSuccess"));try{const c=await M({email:e.email,password:e.password});if(c.data){localStorage.setItem("auth_token",c.data.auth_data);try{const l=[D().then(r=>r.data&&localStorage.setItem("xboard_user_info",JSON.stringify(r.data))),G().then(r=>r.data&&localStorage.setItem("xboard_subscribe_info",JSON.stringify(r.data))),H().then(r=>r.data&&localStorage.setItem("xboard_notices",JSON.stringify(r.data)))];await Promise.race([Promise.allSettled(l),new Promise(r=>setTimeout(r,800))])}catch(l){console.error("Registration pre-fetch failed:",l)}b.push("/");return}}catch(c){console.error("Auto-login failed after registration:",c),b.push("/login")}}}catch{}finally{k.value=!1}};return(e,a)=>{const c=_("a-input"),l=_("a-form-item"),r=_("a-button"),R=_("a-input-password"),A=_("a-checkbox"),B=_("a-form");return v(),C("div",W,[t("div",X,[t("div",Y,[t("div",Z,[t("div",ee,[a[6]||(a[6]=t("div",{class:"logo-glow"},null,-1)),g(f).logoUrl?(v(),C("img",{key:0,src:g(f).logoUrl,alt:g(f).siteName,class:"brand-logo-image"},null,8,ae)):(v(),C("h1",te,"åŠ å…¥ "+n(g(f).siteName),1))]),t("p",se,n(e.$t("auth.registerSubtitle")),1),t("div",oe,[t("div",re,[a[7]||(a[7]=t("div",{class:"badge-icon"},"ðŸ›¡ï¸",-1)),t("span",null,n(e.$t("auth.privacyProtection")),1)]),t("div",le,[a[8]||(a[8]=t("div",{class:"badge-icon"},"âš¡",-1)),t("span",null,n(e.$t("auth.unlimitedTraffic")),1)])])])]),t("div",ie,[t("div",ne,[t("div",de,[t("h2",null,n(e.$t("auth.registerButton")),1),t("p",null,n(e.$t("auth.registerSubtitle")),1)]),o(B,{model:s,onFinish:z,layout:"vertical"},{default:u(()=>[o(l,{label:e.$t("auth.email"),name:"email",rules:[{validator:V}]},{default:u(()=>[o(c,{value:s.email,"onUpdate:value":a[0]||(a[0]=i=>s.email=i),placeholder:"your@email.com",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),p.value.is_email_verify?(v(),I(l,{key:0,label:"é‚®ç®±éªŒè¯ç ",name:"email_code",rules:[{required:!0,message:"è¯·è¾“å…¥é‚®ç®±éªŒè¯ç "}],class:"code-item"},{default:u(()=>[t("div",ue,[o(c,{value:s.email_code,"onUpdate:value":a[1]||(a[1]=i=>s.email_code=i),placeholder:"è¾“å…¥éªŒè¯ç ",size:"large"},null,8,["value"]),o(r,{type:"primary",class:"send-code-btn",disabled:h.value>0||!s.email,onClick:q},{default:u(()=>[S(n(h.value>0?`${h.value}s`:"å‘é€éªŒè¯ç "),1)]),_:1},8,["disabled"])])]),_:1})):N("",!0),o(l,{label:e.$t("auth.password"),name:"password",rules:[{required:!0,message:e.$t("validation.passwordRequired")}]},{default:u(()=>[o(R,{value:s.password,"onUpdate:value":a[2]||(a[2]=i=>s.password=i),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),o(l,{label:e.$t("auth.confirmPassword"),name:"re_password",rules:[{required:!0,message:e.$t("validation.passwordRequired")}]},{default:u(()=>[o(R,{value:s.re_password,"onUpdate:value":a[3]||(a[3]=i=>s.re_password=i),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),o(l,{label:e.$t("auth.inviteCode"),name:"invite_code"},{default:u(()=>[o(c,{value:s.invite_code,"onUpdate:value":a[4]||(a[4]=i=>s.invite_code=i),placeholder:e.$t("auth.inviteCode"),size:"large"},null,8,["value","placeholder"])]),_:1},8,["label"]),g(f).enableCaptcha?(v(),I(K,{key:1,onVerify:U})):N("",!0),o(l,{name:"agreement",rules:[{validator:E}]},{default:u(()=>[o(A,{checked:s.agreement,"onUpdate:checked":a[5]||(a[5]=i=>s.agreement=i)},{default:u(()=>[S(n(e.$t("auth.agreement")),1)]),_:1},8,["checked"])]),_:1},8,["rules"]),o(r,{type:"primary","html-type":"submit",loading:k.value,block:"",size:"large"},{default:u(()=>[S(n(e.$t("auth.registerButton")),1)]),_:1},8,["loading"])]),_:1},8,["model"]),t("div",ce,[t("span",null,n(e.$t("auth.hasAccount")),1),t("a",me,n(e.$t("auth.backToLogin")),1)])])])])])}}},we=Q(fe,[["__scopeId","data-v-79b683e1"]]);export{we as default};
