import{u as U,r as p,a as V,o as q,c,b as e,d as r,g as L,t as s,e as l,w as f,f as u,h as z,i,j as D,k as J,l as _,F as k,m as w}from"./index-K3BHgUgf.js";import{g as O,l as R}from"./auth-BWf5lCMM.js";import{g as T,a as E,b as M}from"./user-zboQRicx.js";import{C as j}from"./Captcha-BpJFZbxP.js";import{_ as A}from"./_plugin-vue_export-helper-CwKUxaPK.js";const G={class:"dark-tech-auth"},H={class:"auth-grid"},K={class:"branding-side"},Q={class:"brand-content"},W={class:"logo-container"},X=["src","alt"],Y={key:1,class:"brand-title"},Z={class:"brand-desc"},x={class:"features"},ee={class:"feature-badge"},ae={class:"feature-badge"},te={class:"feature-badge"},se={class:"form-side"},oe={class:"glass-card form-container"},ne={class:"form-header"},re={class:"form-options"},le={href:"#/forgot-password",class:"link-primary"},ie={class:"form-footer"},de={href:"#/register",class:"link-primary"},ce={__name:"Login",setup(ue){const{t:m}=U(),d=L(),$=p({}),v=p(!1),b=p(""),y=p(null),C=z(),n=V({email:"",password:"",remember:!0}),S=a=>{y.value=a};q(async()=>{try{const a=await O();a.data&&($.value=a.data)}catch(a){console.error("Failed to fetch guest config:",a)}});const N=async a=>{if(d.enableCaptcha){if(y.value===null)return w.error(m("auth.enterCaptcha"));if(y.value===!1)return w.error(m("auth.captchaInvalid"))}v.value=!0;try{const t=await R(a);if(t.data){localStorage.setItem("auth_token",t.data.auth_data),b.value="syncing_data";try{const g=[T().then(o=>o.data&&localStorage.setItem("xboard_user_info",JSON.stringify(o.data))),E().then(o=>o.data&&localStorage.setItem("xboard_subscribe_info",JSON.stringify(o.data))),M().then(o=>o.data&&localStorage.setItem("xboard_notices",JSON.stringify(o.data)))];await Promise.race([Promise.allSettled(g),new Promise(o=>setTimeout(o,800))])}catch(g){console.error("Pre-fetch failed:",g)}w.success(m("auth.loginSuccess")),C.push("/")}}catch(t){console.error("Login error:",t)}finally{v.value=!1}};return(a,t)=>{const g=u("a-input"),o=u("a-form-item"),I=u("a-input-password"),B=u("a-checkbox"),F=u("a-button"),P=u("a-form");return i(),c("div",G,[e("div",H,[e("div",K,[e("div",Q,[e("div",W,[t[3]||(t[3]=e("div",{class:"logo-glow"},null,-1)),r(d).logoUrl?(i(),c("img",{key:0,src:r(d).logoUrl,alt:r(d).siteName,class:"brand-logo-image"},null,8,X)):(i(),c("h1",Y,s(r(d).siteName),1))]),e("p",Z,s(a.$t("auth.brandDesc")),1),e("div",x,[e("div",ee,[t[4]||(t[4]=e("div",{class:"badge-icon"},"ðŸ”’",-1)),e("span",null,s(a.$t("auth.enterpriseEncryption")),1)]),e("div",ae,[t[5]||(t[5]=e("div",{class:"badge-icon"},"ðŸŒ",-1)),e("span",null,s(a.$t("auth.globalNodes")),1)]),e("div",te,[t[6]||(t[6]=e("div",{class:"badge-icon"},"âš¡",-1)),e("span",null,s(a.$t("auth.ultraFastConnection")),1)])])])]),e("div",se,[e("div",oe,[e("div",ne,[e("h2",null,s(a.$t("auth.welcomeBack")),1),e("p",null,s(a.$t("auth.loginSubtitle")),1)]),l(P,{model:n,onFinish:N,layout:"vertical"},{default:f(()=>[l(o,{label:a.$t("auth.email"),name:"email",rules:[{required:!0,message:a.$t("validation.emailRequired")},{type:"email",message:a.$t("validation.emailInvalid")}]},{default:f(()=>[l(g,{value:n.email,"onUpdate:value":t[0]||(t[0]=h=>n.email=h),placeholder:"your@email.com",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),l(o,{label:a.$t("auth.password"),name:"password",rules:[{required:!0,message:a.$t("validation.passwordRequired")}]},{default:f(()=>[l(I,{value:n.password,"onUpdate:value":t[1]||(t[1]=h=>n.password=h),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),r(d).enableCaptcha?(i(),D(j,{key:0,onVerify:S})):J("",!0),e("div",re,[l(B,{checked:n.remember,"onUpdate:checked":t[2]||(t[2]=h=>n.remember=h)},{default:f(()=>[_(s(a.$t("auth.rememberMe")),1)]),_:1},8,["checked"]),e("a",le,s(a.$t("auth.forgotPassword")),1)]),l(F,{type:"primary","html-type":"submit",loading:v.value,block:"",size:"large"},{default:f(()=>[b.value==="auth_success"?(i(),c(k,{key:0},[_(s(r(m)("auth.authenticating")),1)],64)):b.value==="syncing_data"?(i(),c(k,{key:1},[_(s(r(m)("auth.syncingData")),1)],64)):(i(),c(k,{key:2},[_(s(a.$t("auth.loginButton")),1)],64))]),_:1},8,["loading"])]),_:1},8,["model"]),e("div",ie,[e("span",null,s(a.$t("auth.noAccount")),1),e("a",de,s(a.$t("auth.registerNow")),1)])])])])])}}},_e=A(ce,[["__scopeId","data-v-d6a9d720"]]);export{_e as default};
