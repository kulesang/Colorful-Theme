import{b as S,u as q,e as p,h as A,s as P,f as F,i as l,j as a,p as f,l as d,k as i,t as o,F as _,y as g,m as E,n as T,o as c,B as C}from"./index-BHTMErf9.js";import{k as V,l as j,m as H,s as J}from"./user-CAmOVogg.js";import{d as Z}from"./marked.esm-DajSjiQI.js";import{Z as $}from"./zap-CfDD922N.js";import{C as x}from"./circle-check-big-D2FnvZ-L.js";import{R as D}from"./refresh-cw-DR-bsj_a.js";import{A as G}from"./arrow-right-smdgulYX.js";import"./request-BDShSQSj.js";const K={class:"dark-tech-plans animate-fade-in"},Q={class:"page-header"},U={class:"header-icon"},W={key:0,class:"plans-grid"},X={key:0,class:"featured-badge"},Y={class:"plan-header"},ee={class:"plan-name"},se={class:"plan-cycle-selector"},ae=["onClick"],te={class:"plan-price"},re={class:"amount"},le={class:"period"},ce={class:"plan-features"},oe=["innerHTML"],ne={class:"plan-footer"},ie=["onClick","disabled"],de={key:1,class:"loading-state"},ue={key:2,class:"empty-state"},pe={__name:"Plans",setup(_e){const z=T(),{t:k}=q();p([]);const u=p(!0),h=p(!1),v=p(null),m={month_price:{label:"dashboard.plans.cycles.month_price",value:"month_price"},quarter_price:{label:"dashboard.plans.cycles.quarter_price",value:"quarter_price"},half_year_price:{label:"dashboard.plans.cycles.half_year_price",value:"half_year_price"},year_price:{label:"dashboard.plans.cycles.year_price",value:"year_price"},two_year_price:{label:"dashboard.plans.cycles.two_year_price",value:"two_year_price"},three_year_price:{label:"dashboard.plans.cycles.three_year_price",value:"three_year_price"},onetime_price:{label:"dashboard.plans.cycles.onetime_price",value:"onetime_price"},reset_price:{label:"dashboard.plans.cycles.reset_price",value:"reset_price"}},b=p([]);A(()=>{L(),O()});const L=()=>{try{const e=localStorage.getItem("xboard_plan_list");e&&(w(JSON.parse(e)),u.value=!1)}catch(e){console.error("Plans cache load error:",e)}},O=async()=>{try{const e=await V();e.data&&(w(e.data),localStorage.setItem("xboard_plan_list",JSON.stringify(e.data)))}catch{P.error("åŠ è½½å¥—é¤å¤±è´¥")}finally{u.value=!1}},w=e=>{const t=new Map;e.forEach(n=>{if(!t.has(n.id)){const s=[];Object.keys(m).forEach(r=>{n[r]!==null&&n[r]!==void 0&&s.push(m[r])}),t.set(n.id,F({...n,availableCycles:s,selectedCycle:s.length>0?s[0].value:null}))}}),b.value=Array.from(t.values())},R=e=>e.selectedCycle?(e[e.selectedCycle]/100).toFixed(2):"0.00",B=e=>{var t;return((t=m[e])==null?void 0:t.label)||""},M=e=>e?/<[^>]+>|(\*\*|__|^-\s|^\*\s|^#|^\d+\.\s)/m.test(e):!1,I=e=>e?Z.parse(e):"",N=async e=>{if(e.selectedCycle){h.value=!0,v.value=e.id;try{const t=await j();if(t.data&&t.data.length>0){const s=t.data.filter(r=>r.status===0);s.length>0&&await Promise.all(s.map(r=>H({trade_no:r.trade_no}).catch(y=>console.error("Cancel order failed:",y))))}const n=await J({plan_id:e.id,period:e.selectedCycle});n.data&&(P.success("æ–°è®¢å•å·²åˆ›å»º"),z.push({path:"/order",query:{trade_no:n.data}}))}catch{}finally{h.value=!1,v.value=null}}};return(e,t)=>{const n=E("a-spin");return c(),l("div",K,[a("div",Q,[a("div",U,[d(i($),{size:32})]),a("h1",null,o(e.$t("dashboard.plans.title")),1),a("p",null,o(e.$t("dashboard.plans.description")),1)]),u.value?f("",!0):(c(),l("div",W,[(c(!0),l(_,null,g(b.value,s=>(c(),l("div",{key:s.id,class:C(["plan-card glass-card",{featured:s.show}])},[s.show?(c(),l("div",X,[d(i($),{size:12}),a("span",null,o(e.$t("dashboard.plans.featured")),1)])):f("",!0),a("div",Y,[a("h3",ee,o(s.name),1),a("div",se,[(c(!0),l(_,null,g(s.availableCycles,r=>(c(),l("div",{key:r.value,class:C(["cycle-btn",{active:s.selectedCycle===r.value}]),onClick:y=>s.selectedCycle=r.value},o(i(k)(r.label)),11,ae))),128))]),a("div",te,[t[0]||(t[0]=a("span",{class:"currency"},"Â¥",-1)),a("span",re,o(R(s)),1),a("span",le,"/ "+o(i(k)(B(s.selectedCycle))),1)])]),a("div",ce,[M(s.content)?(c(),l("div",{key:0,class:"plan-features-html",innerHTML:I(s.content)},null,8,oe)):(c(!0),l(_,{key:1},g((s.content||"").split(`
`),(r,y)=>(c(),l("div",{class:"feature-item",key:y},[d(i(x),{size:16,class:"check-icon"}),a("span",null,o(r),1)]))),128))]),a("div",ne,[a("button",{class:C(["buy-btn",{featured:s.show}]),onClick:r=>N(s),disabled:h.value},[h.value&&v.value===s.id?(c(),l(_,{key:0},[d(i(D),{class:"animate-spin",size:18}),a("span",null,o(e.$t("dashboard.plans.processing")),1)],64)):(c(),l(_,{key:1},[a("span",null,o(e.$t("dashboard.plans.subscribe")),1),d(i(G),{size:18})],64))],10,ie)])],2))),128))])),u.value?(c(),l("div",de,[d(n,{size:"large"})])):f("",!0),!u.value&&b.value.length===0?(c(),l("div",ue,[t[1]||(t[1]=a("div",{class:"empty-icon"},"ðŸ“‚",-1)),a("p",null,o(e.$t("dashboard.plans.noPlans")),1)])):f("",!0)])}}},ke=S(pe,[["__scopeId","data-v-d070fcc1"]]);export{ke as default};
