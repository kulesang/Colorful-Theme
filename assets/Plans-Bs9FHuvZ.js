import{u as N,r as _,o as R,m as P,a as S,c as l,b as s,k as v,e as d,d as i,t as o,F as p,x as g,f as q,h as F,i as c,y as C}from"./index-DBj0bk-v.js";import{h as A,i as E,j as V,s as j}from"./user-DXsAa-Hk.js";import{_ as H}from"./_plugin-vue_export-helper-tGYcrXWe.js";import{Z as $}from"./zap-C38k1K2w.js";import{C as J}from"./circle-check-big-DRPSyYaj.js";import{R as T}from"./refresh-cw-BgTXoq3M.js";import{A as Z}from"./arrow-right-CCZkEe8O.js";import"./createLucideIcon-CI9fqIqV.js";const x={class:"dark-tech-plans animate-fade-in"},D={class:"page-header"},G={class:"header-icon"},K={key:0,class:"plans-grid"},Q={key:0,class:"featured-badge"},U={class:"plan-header"},W={class:"plan-name"},X={class:"plan-cycle-selector"},Y=["onClick"],ee={class:"plan-price"},ae={class:"amount"},se={class:"period"},te={class:"plan-features"},re=["innerHTML"],le={class:"plan-footer"},ce=["onClick","disabled"],oe={key:1,class:"loading-state"},ne={key:2,class:"empty-state"},ie={__name:"Plans",setup(de){const z=F(),{t:k}=N();_([]);const u=_(!0),h=_(!1),f=_(null),m={month_price:{label:"dashboard.plans.cycles.month_price",value:"month_price"},quarter_price:{label:"dashboard.plans.cycles.quarter_price",value:"quarter_price"},half_year_price:{label:"dashboard.plans.cycles.half_year_price",value:"half_year_price"},year_price:{label:"dashboard.plans.cycles.year_price",value:"year_price"},two_year_price:{label:"dashboard.plans.cycles.two_year_price",value:"two_year_price"},three_year_price:{label:"dashboard.plans.cycles.three_year_price",value:"three_year_price"},onetime_price:{label:"dashboard.plans.cycles.onetime_price",value:"onetime_price"},reset_price:{label:"dashboard.plans.cycles.reset_price",value:"reset_price"}},b=_([]);R(()=>{L(),O()});const L=()=>{try{const e=localStorage.getItem("xboard_plan_list");e&&(w(JSON.parse(e)),u.value=!1)}catch(e){console.error("Plans cache load error:",e)}},O=async()=>{try{const e=await A();e.data&&(w(e.data),localStorage.setItem("xboard_plan_list",JSON.stringify(e.data)))}catch{P.error("åŠ è½½å¥—é¤å¤±è´¥")}finally{u.value=!1}},w=e=>{const t=new Map;e.forEach(n=>{if(!t.has(n.id)){const a=[];Object.keys(m).forEach(r=>{n[r]!==null&&n[r]!==void 0&&a.push(m[r])}),t.set(n.id,S({...n,availableCycles:a,selectedCycle:a.length>0?a[0].value:null}))}}),b.value=Array.from(t.values())},M=e=>e.selectedCycle?(e[e.selectedCycle]/100).toFixed(2):"0.00",B=e=>{var t;return((t=m[e])==null?void 0:t.label)||""},I=async e=>{if(e.selectedCycle){h.value=!0,f.value=e.id;try{const t=await E();if(t.data&&t.data.length>0){const a=t.data.filter(r=>r.status===0);a.length>0&&await Promise.all(a.map(r=>V({trade_no:r.trade_no}).catch(y=>console.error("Cancel order failed:",y))))}const n=await j({plan_id:e.id,period:e.selectedCycle});n.data&&(P.success("æ–°è®¢å•å·²åˆ›å»º"),z.push({path:"/order",query:{trade_no:n.data}}))}catch{}finally{h.value=!1,f.value=null}}};return(e,t)=>{const n=q("a-spin");return c(),l("div",x,[s("div",D,[s("div",G,[d(i($),{size:32})]),s("h1",null,o(e.$t("dashboard.plans.title")),1),s("p",null,o(e.$t("dashboard.plans.description")),1)]),u.value?v("",!0):(c(),l("div",K,[(c(!0),l(p,null,g(b.value,a=>(c(),l("div",{key:a.id,class:C(["plan-card glass-card",{featured:a.show}])},[a.show?(c(),l("div",Q,[d(i($),{size:12}),s("span",null,o(e.$t("dashboard.plans.featured")),1)])):v("",!0),s("div",U,[s("h3",W,o(a.name),1),s("div",X,[(c(!0),l(p,null,g(a.availableCycles,r=>(c(),l("div",{key:r.value,class:C(["cycle-btn",{active:a.selectedCycle===r.value}]),onClick:y=>a.selectedCycle=r.value},o(i(k)(r.label)),11,Y))),128))]),s("div",ee,[t[0]||(t[0]=s("span",{class:"currency"},"Â¥",-1)),s("span",ae,o(M(a)),1),s("span",se,"/ "+o(i(k)(B(a.selectedCycle))),1)])]),s("div",te,[(a.content||"").includes("<")?(c(),l("div",{key:0,class:"plan-features-html",innerHTML:a.content},null,8,re)):(c(!0),l(p,{key:1},g((a.content||"").split(`
`),(r,y)=>(c(),l("div",{class:"feature-item",key:y},[d(i(J),{size:16,class:"check-icon"}),s("span",null,o(r),1)]))),128))]),s("div",le,[s("button",{class:C(["buy-btn",{featured:a.show}]),onClick:r=>I(a),disabled:h.value},[h.value&&f.value===a.id?(c(),l(p,{key:0},[d(i(T),{class:"animate-spin",size:18}),s("span",null,o(e.$t("dashboard.plans.processing")),1)],64)):(c(),l(p,{key:1},[s("span",null,o(e.$t("dashboard.plans.subscribe")),1),d(i(Z),{size:18})],64))],10,ce)])],2))),128))])),u.value?(c(),l("div",oe,[d(n,{size:"large"})])):v("",!0),!u.value&&b.value.length===0?(c(),l("div",ne,[t[1]||(t[1]=s("div",{class:"empty-icon"},"ðŸ“‚",-1)),s("p",null,o(e.$t("dashboard.plans.noPlans")),1)])):v("",!0)])}}},be=H(ie,[["__scopeId","data-v-e125182b"]]);export{be as default};
