import{u as W,r as m,a as T,o as X,c as y,b as s,e as r,d as u,t as a,k as w,B as $,C as I,j as U,w as B,f as N,m as M,M as Q,i as f,l as Y}from"./index-K3BHgUgf.js";import{g as Z,y as ss,z as es,a as J,A as ts,B as as,C as os}from"./user-zboQRicx.js";import{g as is}from"./auth-BWf5lCMM.js";import{_ as ns}from"./_plugin-vue_export-helper-CwKUxaPK.js";import{S as rs}from"./settings-CvjkEFTi.js";import{L as ds}from"./lock-CRTUhlWQ.js";import{S as A}from"./send-DEnAt0Xu.js";import{C as ls}from"./circle-x-CdqbghJd.js";import{c as V}from"./createLucideIcon-6IQhkzLg.js";import{C as D}from"./copy-CSfNAGeK.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=V("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=V("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),ms={class:"settings-page"},fs={class:"page-header"},gs={class:"header-icon"},ps={class:"settings-container"},_s={class:"settings-card glass-card"},hs={class:"card-title"},bs={class:"form-group"},vs={class:"form-group"},ys={class:"balance-display"},ws={class:"form-group"},ks={class:"info-text"},Ss={class:"settings-card glass-card"},$s={class:"card-title"},Is={class:"form-group"},Cs=["placeholder"],Ts={class:"form-group"},Us=["placeholder"],Bs={class:"form-group"},Ns=["placeholder"],Ms=["disabled"],Os={key:0,class:"settings-card glass-card"},Ps={class:"card-header-with-action"},xs={class:"card-title"},zs={class:"card-desc"},Js={key:0,class:"telegram-bind-section"},As={class:"info-row"},Ds={class:"label"},Vs={class:"value"},Ls={key:1,class:"telegram-unbind-section"},Fs={class:"info-row"},qs={class:"value"},Es=["disabled"],js={key:2,class:"telegram-notifications mt-6 pt-6 border-t border-white/10"},Gs={class:"text-sm font-semibold mb-4"},Hs={class:"notification-item"},Ks={class:"notification-info"},Rs={class:"notification-label"},Ws={class:"notification-item"},Xs={class:"notification-info"},Qs={class:"notification-label"},Ys={class:"modal-header-custom"},Zs={class:"header-icon-box"},se={class:"header-text-box"},ee={class:"text-xl font-bold mb-0"},te={class:"text-sm text-gray-400 mb-0"},ae={class:"modal-steps-container"},oe={class:"bind-step"},ie={class:"step-badge"},ne={class:"step-desc"},re={class:"copy-box"},de={class:"copy-text"},le={class:"copy-actions"},ce={class:"bind-step"},ue={class:"step-badge"},me={class:"step-desc"},fe={class:"copy-box command-box"},ge={class:"copy-text"},pe={class:"bind-tip"},_e={class:"tip-text"},he={class:"modal-custom-footer"},be={class:"settings-card glass-card"},ve={class:"card-title"},ye={class:"security-item"},we={class:"security-info"},ke={class:"security-icon"},Se={class:"security-info-text"},$e={class:"security-label"},Ie={class:"security-desc"},Ce=["disabled"],Te={class:"settings-card glass-card"},Ue={class:"notification-item"},Be={class:"notification-item"},Ne={class:"notification-item"},Me={name:"UserSettings"},Oe=Object.assign(Me,{setup(Pe){const{t:d}=W(),C=m(!0),i=m({}),b=m(!1),v=m(!1),g=m({}),k=m(!1),p=m({}),S=m(!1),n=T({old_password:"",new_password:"",confirm_password:""}),l=T({remind_traffic:!1,remind_expire:!1}),_=T({order:!0,traffic:!0,system:!0});X(async()=>{F(),L(),O(),q()});const L=async()=>{try{const e=localStorage.getItem("xboard_guest_config");if(e){const h=JSON.parse(e);C.value=!!h.is_telegram}const t=await is();t.data&&(C.value=!!t.data.is_telegram,localStorage.setItem("xboard_guest_config",JSON.stringify(t.data)))}catch(e){console.error("Fetch guest config error:",e)}},F=()=>{try{const e=localStorage.getItem("xboard_user_info");if(e){const c=JSON.parse(e);i.value=c,l.remind_traffic=!!c.remind_traffic,l.remind_expire=!!c.remind_expire}const t=localStorage.getItem("xboard_bot_info");t&&(g.value=JSON.parse(t));const h=localStorage.getItem("xboard_subscribe_info");h&&(p.value=JSON.parse(h))}catch(e){console.error("Cache load error:",e)}},O=async()=>{try{const e=await Z();e.data&&(i.value=e.data,l.remind_traffic=!!e.data.remind_traffic,l.remind_expire=!!e.data.remind_expire,localStorage.setItem("xboard_user_info",JSON.stringify(e.data)))}catch{}},q=async()=>{try{const e=await ss();e.data&&(g.value=e.data,localStorage.setItem("xboard_bot_info",JSON.stringify(e.data)))}catch{}},E=async()=>{if(k.value=!0,!p.value.subscribe_url)try{const e=await J();e.data&&(p.value=e.data,localStorage.setItem("xboard_subscribe_info",JSON.stringify(e.data)))}catch{}},P=()=>{g.value.username?window.open(`https://t.me/${g.value.username}`,"_blank"):AMessage.warning("Telegram bot info not available")},x=e=>{navigator.clipboard.writeText(e).then(()=>{AMessage.success(d("telegram.copySuccess"))})},j=async()=>{v.value=!0;try{if((await ts()).data){AMessage.success(d("telegram.unBindSuccess"));const t={...i.value,telegram_id:null};i.value=t,localStorage.setItem("xboard_user_info",JSON.stringify(t)),O()}}catch{}finally{v.value=!1}},z=async()=>{try{const e={remind_traffic:l.remind_traffic?1:0,remind_expire:l.remind_expire?1:0};await os(e);const t={...i.value,...e};i.value=t,localStorage.setItem("xboard_user_info",JSON.stringify(t)),M.success(d("telegram.switchSuccess"))}catch{}},G=e=>e?new Date(e*1e3).toLocaleDateString("zh-CN"):"--",H=async()=>{if(!n.old_password||!n.new_password||!n.confirm_password){AMessage.error(d("dashboard.settings.fillAllFields"));return}if(n.new_password!==n.confirm_password){AMessage.error(d("dashboard.settings.passwordMismatch"));return}b.value=!0;try{await es({old_password:n.old_password,new_password:n.new_password}),M.success(d("dashboard.settings.passwordChanged")),setTimeout(()=>{localStorage.removeItem("auth_token"),window.location.href="/#/login"},1500)}catch{}finally{b.value=!1}},K=()=>{Q.confirm({title:d("dashboard.settings.resetSecurity"),content:d("dashboard.settings.resetConfirm"),okText:d("dashboard.settings.resetSecurityBtn"),cancelText:d("common.cancel"),okType:"danger",centered:!0,async onOk(){S.value=!0;try{await as(),M.success(d("dashboard.settings.resetSuccess"));const e=await J();e.data&&(p.value=e.data,localStorage.setItem("xboard_subscribe_info",JSON.stringify(e.data)))}catch{}finally{S.value=!1}}})};return(e,t)=>{const h=N("a-tag"),c=N("a-switch"),R=N("a-modal");return f(),y("div",ms,[s("div",fs,[s("div",gs,[r(u(rs),{size:32})]),s("h1",null,a(e.$t("dashboard.settings.title")),1),s("p",null,a(e.$t("dashboard.settings.description")),1)]),s("div",ps,[s("div",_s,[s("h3",hs,a(e.$t("dashboard.settings.accountInfo")),1),s("div",bs,[s("label",null,a(e.$t("dashboard.settings.email")),1),$(s("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>i.value.email=o),disabled:"",class:"form-input"},null,512),[[I,i.value.email]])]),s("div",vs,[s("label",null,a(e.$t("dashboard.settings.balance")),1),s("div",ys," Â¥"+a(((i.value.balance||0)/100).toFixed(2)),1)]),s("div",ws,[s("label",null,a(e.$t("dashboard.settings.registerTime")),1),s("div",ks,a(G(i.value.created_at)),1)])]),s("div",Ss,[s("h3",$s,a(e.$t("dashboard.settings.changePassword")),1),s("div",Is,[s("label",null,a(e.$t("dashboard.settings.currentPassword")),1),$(s("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>n.old_password=o),type:"password",placeholder:e.$t("dashboard.settings.currentPasswordPlaceholder"),class:"form-input"},null,8,Cs),[[I,n.old_password]])]),s("div",Ts,[s("label",null,a(e.$t("dashboard.settings.newPassword")),1),$(s("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>n.new_password=o),type:"password",placeholder:e.$t("dashboard.settings.newPasswordPlaceholder"),class:"form-input"},null,8,Us),[[I,n.new_password]])]),s("div",Bs,[s("label",null,a(e.$t("dashboard.settings.confirmPassword")),1),$(s("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>n.confirm_password=o),type:"password",placeholder:e.$t("dashboard.settings.confirmPasswordPlaceholder"),class:"form-input"},null,8,Ns),[[I,n.confirm_password]])]),s("button",{class:"submit-btn",onClick:H,disabled:b.value},[b.value?w("",!0):(f(),U(u(ds),{key:0,size:18})),s("span",null,a(b.value?e.$t("dashboard.settings.changing"):e.$t("dashboard.settings.changePasswordBtn")),1)],8,Ms)]),C.value?(f(),y("div",Os,[s("div",Ps,[s("h3",xs,a(e.$t("telegram.title")),1),i.value.telegram_id?(f(),U(h,{key:0,color:"success",class:"status-tag"},{default:B(()=>[Y(a(e.$t("telegram.bindingSuccess")),1)]),_:1})):w("",!0)]),s("p",zs,a(e.$t("telegram.description")),1),i.value.telegram_id?(f(),y("div",Ls,[s("div",Fs,[t[13]||(t[13]=s("span",{class:"label"},"Telegram ID:",-1)),s("span",qs,a(i.value.telegram_id),1)]),s("button",{class:"unbind-btn",onClick:j,disabled:v.value},[v.value?w("",!0):(f(),U(u(ls),{key:0,size:18})),s("span",null,a(v.value?e.$t("telegram.unbinding"):e.$t("telegram.unBindBtn")),1)],8,Es)])):(f(),y("div",Js,[s("div",As,[s("span",Ds,a(e.$t("telegram.botName"))+":",1),s("span",Vs,"@"+a(g.value.username||"Loading..."),1)]),s("button",{class:"telegram-btn",onClick:E},[r(u(A),{size:18}),s("span",null,a(e.$t("telegram.bindAccount")),1)])])),i.value.telegram_id?(f(),y("div",js,[s("h4",Gs,a(e.$t("telegram.notifications")),1),s("div",Hs,[s("div",Ks,[s("div",Rs,a(e.$t("telegram.trafficWarning")),1)]),r(c,{checked:l.remind_traffic,"onUpdate:checked":t[4]||(t[4]=o=>l.remind_traffic=o),onChange:z},null,8,["checked"])]),s("div",Ws,[s("div",Xs,[s("div",Qs,a(e.$t("telegram.planExpire")),1)]),r(c,{checked:l.remind_expire,"onUpdate:checked":t[5]||(t[5]=o=>l.remind_expire=o),onChange:z},null,8,["checked"])])])):w("",!0)])):w("",!0),r(R,{visible:k.value,"onUpdate:visible":t[9]||(t[9]=o=>k.value=o),footer:null,closable:!0,width:460,centered:"",class:"telegram-bind-modal"},{title:B(()=>[s("div",Ys,[s("div",Zs,[r(u(A),{size:24,color:"#0088cc"})]),s("div",se,[s("h2",ee,a(e.$t("telegram.bindAccount")),1),s("p",te,a(e.$t("telegram.bindStepsTitle")),1)])])]),default:B(()=>[s("div",ae,[s("div",oe,[s("div",ie,a(e.$t("telegram.step1")),1),s("p",ne,a(e.$t("telegram.step1Desc")),1),s("div",re,[s("span",de,"@"+a(g.value.username),1),s("div",le,[r(u(D),{size:18,class:"copy-btn-icon",onClick:t[6]||(t[6]=o=>x(`@${g.value.username}`))}),r(u(cs),{size:18,class:"copy-btn-icon",onClick:P})])])]),s("div",ce,[s("div",ue,a(e.$t("telegram.step2")),1),s("p",me,a(e.$t("telegram.step2Desc")),1),s("div",fe,[s("span",ge,"/bind "+a(p.value.subscribe_url),1),r(u(D),{size:18,class:"copy-btn-icon",onClick:t[7]||(t[7]=o=>x(`/bind ${p.value.subscribe_url}`))})])]),s("div",pe,[t[14]||(t[14]=s("span",{class:"tip-icon"},"ðŸ’¡",-1)),s("span",_e,a(e.$t("telegram.tip"))+": "+a(e.$t("telegram.tipDesc")),1)])]),s("div",he,[s("button",{class:"footer-btn secondary",onClick:t[8]||(t[8]=o=>k.value=!1)},a(e.$t("telegram.close")),1),s("button",{class:"footer-btn primary",onClick:P},a(e.$t("telegram.openTelegram")),1)])]),_:1},8,["visible"]),s("div",be,[s("h3",ve,a(e.$t("dashboard.settings.securitySettings")),1),s("div",ye,[s("div",we,[s("div",ke,[r(u(us),{size:20})]),s("div",Se,[s("div",$e,a(e.$t("dashboard.settings.resetSecurity")),1),s("div",Ie,a(e.$t("dashboard.settings.resetSecurityDesc")),1)])]),s("button",{class:"security-action",onClick:K,disabled:S.value},a(S.value?e.$t("dashboard.settings.reseting"):e.$t("dashboard.settings.resetSecurityBtn")),9,Ce)])]),s("div",Te,[t[18]||(t[18]=s("h3",{class:"card-title"},"é€šçŸ¥è®¾ç½®",-1)),s("div",Ue,[t[15]||(t[15]=s("div",{class:"notification-info"},[s("div",{class:"notification-label"},"è®¢å•é€šçŸ¥"),s("div",{class:"notification-desc"},"è®¢å•çŠ¶æ€å˜æ›´æ—¶é€šçŸ¥")],-1)),r(c,{checked:_.order,"onUpdate:checked":t[10]||(t[10]=o=>_.order=o)},null,8,["checked"])]),s("div",Be,[t[16]||(t[16]=s("div",{class:"notification-info"},[s("div",{class:"notification-label"},"æµé‡æé†’"),s("div",{class:"notification-desc"},"æµé‡å³å°†ç”¨å°½æ—¶æé†’")],-1)),r(c,{checked:_.traffic,"onUpdate:checked":t[11]||(t[11]=o=>_.traffic=o)},null,8,["checked"])]),s("div",Ne,[t[17]||(t[17]=s("div",{class:"notification-info"},[s("div",{class:"notification-label"},"ç³»ç»Ÿå…¬å‘Š"),s("div",{class:"notification-desc"},"æŽ¥æ”¶ç³»ç»Ÿé€šçŸ¥å’Œå…¬å‘Š")],-1)),r(c,{checked:_.system,"onUpdate:checked":t[12]||(t[12]=o=>_.system=o)},null,8,["checked"])])])])])}}}),je=ns(Oe,[["__scopeId","data-v-da29d34f"]]);export{je as default};
