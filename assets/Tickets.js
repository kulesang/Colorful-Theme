import{r,o as I,c as d,b as e,k as u,e as v,d as h,t as o,F as R,y as A,f as D,w as M,i as c,v as N,l as P,B as T,G as w,j as E,m as y}from"./index.js";import{p as G,q as H,r as J,t as K,u as O}from"./user.js";import{_ as Q}from"./_plugin-vue_export-helper.js";import{T as W}from"./ticket.js";import{P as X}from"./plus.js";import{C as Y}from"./clock.js";import{c as Z}from"./createLucideIcon.js";import{S as x}from"./send.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=Z("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]),te={class:"tickets-page"},se={class:"page-header"},ae={class:"header-icon"},le={class:"action-bar"},oe={key:0,class:"tickets-list"},ie=["onClick"],ce={class:"ticket-header"},de={class:"ticket-title-area"},ne={class:"ticket-title"},re={class:"ticket-id"},ue={class:"ticket-body"},ve={class:"ticket-preview"},ke={class:"ticket-meta"},pe={class:"meta-item"},me={key:0,class:"meta-item"},he={key:1,class:"loading-state"},be={key:2,class:"empty-state"},_e={class:"new-ticket-form"},fe={class:"form-group"},ye=["placeholder"],ge={class:"form-group"},Te=["placeholder"],we=["disabled"],$e={key:0,class:"ticket-detail"},Ce={class:"detail-header"},ze={class:"detail-content"},je={key:0,class:"reply-form"},Ve=["placeholder"],De={__name:"Tickets",setup(Me){const g=r([]),b=r(!0),_=r(!1),k=r(!1),i=r(null),p=r(!1),m=r(""),n=r({subject:"",level:1,message:""});I(async()=>{await f()});const f=async()=>{try{const s=await G();s.data&&(g.value=s.data)}catch{}finally{b.value=!1}},$=s=>({0:t("dashboard.tickets.statusPending"),1:t("dashboard.tickets.statusClosed")})[s]||t("dashboard.tickets.statusUnknown"),C=s=>({0:"pending",1:"closed"})[s]||"",S=s=>s?new Date(s*1e3).toLocaleString("zh-CN"):"--",U=async()=>{if(!n.value.subject||!n.value.message){y.error(t("dashboard.tickets.fillComplete"));return}p.value=!0;try{await J(n.value),y.success(t("dashboard.tickets.submitted")),_.value=!1,n.value={subject:"",level:1,message:""},await f()}catch{}finally{p.value=!1}},B=async s=>{try{const l=await H({id:s.id});l.data&&(i.value=l.data,k.value=!0)}catch{}},L=async()=>{if(m.value)try{await K({id:i.value.id,message:m.value}),y.success(t("dashboard.tickets.replySent")),m.value="",k.value=!1,await f()}catch{}},q=async()=>{try{await O({id:i.value.id}),y.success(t("dashboard.tickets.ticketClosed")),k.value=!1,await f()}catch{}};return(s,l)=>{var j;const F=D("a-spin"),z=D("a-modal");return c(),d("div",te,[e("div",se,[e("div",ae,[v(h(W),{size:32})]),e("h1",null,o(s.$t("dashboard.tickets.title")),1),e("p",null,o(s.$t("dashboard.tickets.description")),1)]),e("div",le,[e("button",{class:"new-ticket-btn",onClick:l[0]||(l[0]=a=>_.value=!0)},[v(h(X),{size:18}),e("span",null,o(s.$t("dashboard.tickets.newTicket")),1)])]),b.value?u("",!0):(c(),d("div",oe,[(c(!0),d(R,null,A(g.value,a=>{var V;return c(),d("div",{key:a.id,class:"ticket-card glass-card",onClick:Ne=>B(a)},[e("div",ce,[e("div",de,[e("h3",ne,o(a.subject),1),e("span",{class:N(["ticket-status",C(a.status)])},o($(a.status)),3)]),e("div",re,"#"+o(a.id),1)]),e("div",ue,[e("div",ve,o((V=a.message)==null?void 0:V.substring(0,100))+"...",1),e("div",ke,[e("span",pe,[v(h(Y),{size:14}),P(" "+o(S(a.updated_at||a.created_at)),1)]),a.reply_count?(c(),d("span",me,[v(h(ee),{size:14}),P(" "+o(a.reply_count)+" "+o(s.$t("dashboard.tickets.replies")),1)])):u("",!0)])])],8,ie)}),128))])),b.value?(c(),d("div",he,[v(F,{size:"large"})])):u("",!0),!b.value&&g.value.length===0?(c(),d("div",be,[l[6]||(l[6]=e("div",{class:"empty-icon"},"ðŸŽ«",-1)),e("p",null,o(s.$t("dashboard.tickets.noTickets")),1)])):u("",!0),v(z,{visible:_.value,"onUpdate:visible":l[3]||(l[3]=a=>_.value=a),title:s.$t("dashboard.tickets.createTitle"),footer:null,centered:"",class:"ticket-modal"},{default:M(()=>[e("div",_e,[e("div",fe,[e("label",null,o(s.$t("dashboard.tickets.ticketTitle")),1),T(e("input",{"onUpdate:modelValue":l[1]||(l[1]=a=>n.value.subject=a),placeholder:s.$t("dashboard.tickets.titlePlaceholder"),class:"form-input"},null,8,ye),[[w,n.value.subject]])]),e("div",ge,[e("label",null,o(s.$t("dashboard.tickets.problemDescription")),1),T(e("textarea",{"onUpdate:modelValue":l[2]||(l[2]=a=>n.value.message=a),placeholder:s.$t("dashboard.tickets.descriptionPlaceholder"),class:"form-textarea"},null,8,Te),[[w,n.value.message]])]),e("button",{class:"submit-btn",onClick:U,disabled:p.value},[p.value?u("",!0):(c(),E(h(x),{key:0,size:18})),e("span",null,o(p.value?s.$t("dashboard.tickets.submitting"):s.$t("dashboard.tickets.submit")),1)],8,we)])]),_:1},8,["visible","title"]),v(z,{visible:k.value,"onUpdate:visible":l[5]||(l[5]=a=>k.value=a),title:"#"+((j=i.value)==null?void 0:j.id)+" "+s.$t("dashboard.tickets.detailTitle"),footer:null,width:700,centered:"",class:"ticket-modal"},{default:M(()=>[i.value?(c(),d("div",$e,[e("div",Ce,[e("h3",null,o(i.value.subject),1),e("span",{class:N(["ticket-status",C(i.value.status)])},o($(i.value.status)),3)]),e("div",ze,[e("p",null,o(i.value.message),1)]),i.value.status!==1?(c(),d("div",je,[T(e("textarea",{"onUpdate:modelValue":l[4]||(l[4]=a=>m.value=a),placeholder:s.$t("dashboard.tickets.replyPlaceholder"),class:"form-textarea"},null,8,Ve),[[w,m.value]]),e("button",{class:"submit-btn",onClick:L},o(s.$t("dashboard.tickets.sendReply")),1)])):u("",!0),i.value.status===0?(c(),d("button",{key:1,class:"close-ticket-btn",onClick:q},o(s.$t("dashboard.tickets.closeTicket")),1)):u("",!0)])):u("",!0)]),_:1},8,["visible","title"])])}}},Re=Q(De,[["__scopeId","data-v-6fad741d"]]);export{Re as default};
