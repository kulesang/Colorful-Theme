import{b as D,u as G,e as h,f as W,h as P,v as H,c as K,x as Q,i as b,j as t,k,g as X,t as u,l as o,w as r,m as c,n as Y,o as m,a as q,p as V,F as Z,y as ee,q as $,s as f}from"./index-BsMe8Fqi.js";import{g as ae,s as te,r as se,l as le}from"./auth-CtEOLjvL.js";import{g as oe,a as ie,b as re}from"./user-DppSPYD1.js";import{C as ne}from"./Captcha-DbQupXmd.js";import"./request-0A0t0XuS.js";const ue={class:"dark-tech-auth"},de={class:"auth-grid"},ce={class:"branding-side"},me={class:"brand-content"},fe={class:"logo-container"},ve=["src","alt"],_e={key:1,class:"brand-title"},pe={class:"brand-desc"},he={class:"features"},ge={class:"feature-badge"},we={class:"feature-badge"},ye={class:"form-side"},be={class:"glass-card form-container"},ke={class:"form-header"},$e={key:0,class:"email-whitelist-input"},Ce={class:"code-input-group"},Se={class:"form-footer"},xe={__name:"Register",setup(qe){const{t:d}=G(),v=X(),N=Y(),C=H(),I=h(!1),n=h({}),S=h(null),B=e=>{S.value=e},s=W({email:"",password:"",re_password:"",email_code:"",invite_code:"",agreement:!0}),R=h(!1),g=h(0);let U=null;const F=async()=>{if(!s.email)return f.error(d("validation.emailRequired"));if(v.enableCaptcha&&S.value!==!0)return f.error(d("auth.enterCaptcha"));try{R.value=!0,await te({email:s.email}),f.success(d("auth.codeSent")),g.value=60,U=setInterval(()=>{g.value--,g.value<=0&&clearInterval(U)},1e3)}catch(e){f.error(e.message||d("auth.sendFailed"))}};P(async()=>{C.query.code&&(s.invite_code=C.query.code);try{const e=await ae();e.data&&(n.value=e.data,n.value.email_whitelist_suffix&&n.value.email_whitelist_suffix.length>0&&(y.value=n.value.email_whitelist_suffix[0]))}catch(e){console.error("Failed to fetch config:",e)}});const A=K(()=>n.value.email_whitelist_suffix&&Array.isArray(n.value.email_whitelist_suffix)&&n.value.email_whitelist_suffix.length>0),x=h(""),y=h("");Q([x,y],()=>{A.value&&(s.email=`${x.value}@${y.value}`)});const T=async(e,a)=>{if(!a)throw new Error("è¯·æŽ¥å—æœåŠ¡æ¡æ¬¾")},J=async(e,a)=>{if(!a)throw new Error("è¯·è¾“å…¥é‚®ç®±");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))throw new Error(d("validation.emailInvalid"));if(n.value.email_whitelist_suffix&&Array.isArray(n.value.email_whitelist_suffix)){const p=a.split("@")[1];if(!n.value.email_whitelist_suffix.includes(p))throw new Error(d("validation.emailSuffixNotAllowed",{suffixes:n.value.email_whitelist_suffix.join(", ")}))}},L=async e=>{if(v.enableCaptcha){if(S.value===null)return f.error(d("auth.enterCaptcha"));if(S.value===!1)return f.error(d("auth.captchaInvalid"))}if(e.password!==e.re_password)return f.error(d("validation.passwordMismatch"));I.value=!0;try{if((await se(e)).data){f.success(d("auth.registerSuccess"));try{const _=await le({email:e.email,password:e.password});if(_.data){localStorage.setItem("auth_token",_.data.auth_data);try{const p=[oe().then(i=>i.data&&localStorage.setItem("xboard_user_info",JSON.stringify(i.data))),ie().then(i=>i.data&&localStorage.setItem("xboard_subscribe_info",JSON.stringify(i.data))),re().then(i=>i.data&&localStorage.setItem("xboard_notices",JSON.stringify(i.data)))];await Promise.race([Promise.allSettled(p),new Promise(i=>setTimeout(i,800))])}catch(p){console.error("Registration pre-fetch failed:",p)}N.push("/");return}}catch(_){console.error("Auto-login failed after registration:",_),N.push("/login")}}}catch{}finally{I.value=!1}};return P(()=>{C.query.invite_code&&(s.inviteCode=C.query.invite_code)}),(e,a)=>{const _=c("a-select-option"),p=c("a-select"),i=c("a-input"),w=c("a-form-item"),E=c("a-button"),z=c("a-input-password"),O=c("a-checkbox"),j=c("a-form"),M=c("router-link");return m(),b("div",ue,[t("div",de,[t("div",ce,[t("div",me,[t("div",fe,[a[8]||(a[8]=t("div",{class:"logo-glow"},null,-1)),k(v).logoUrl?(m(),b("img",{key:0,src:k(v).logoUrl,alt:k(v).siteName,class:"brand-logo-image"},null,8,ve)):(m(),b("h1",_e,"åŠ å…¥ "+u(k(v).siteName),1))]),t("p",pe,u(e.$t("auth.registerSubtitle")),1),t("div",he,[t("div",ge,[a[9]||(a[9]=t("div",{class:"badge-icon"},"ðŸ›¡ï¸",-1)),t("span",null,u(e.$t("auth.privacyProtection")),1)]),t("div",we,[a[10]||(a[10]=t("div",{class:"badge-icon"},"âš¡",-1)),t("span",null,u(e.$t("auth.unlimitedTraffic")),1)])])])]),t("div",ye,[t("div",be,[t("div",ke,[t("h2",null,u(e.$t("auth.registerButton")),1),t("p",null,u(e.$t("auth.registerSubtitle")),1)]),o(j,{model:s,onFinish:L,layout:"vertical"},{default:r(()=>[o(w,{label:e.$t("auth.email"),name:"email",rules:[{validator:J}]},{default:r(()=>[A.value?(m(),b("div",$e,[o(i,{value:x.value,"onUpdate:value":a[1]||(a[1]=l=>x.value=l),placeholder:"example",size:"large"},{addonAfter:r(()=>[o(p,{value:y.value,"onUpdate:value":a[0]||(a[0]=l=>y.value=l),class:"suffix-select"},{default:r(()=>[(m(!0),b(Z,null,ee(n.value.email_whitelist_suffix,l=>(m(),q(_,{key:l,value:l},{default:r(()=>[$(" @"+u(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["value"])])):(m(),q(i,{key:1,value:s.email,"onUpdate:value":a[2]||(a[2]=l=>s.email=l),placeholder:"your@email.com",size:"large"},null,8,["value"]))]),_:1},8,["label","rules"]),n.value.is_email_verify?(m(),q(w,{key:0,label:"é‚®ç®±éªŒè¯ç ",name:"email_code",rules:[{required:!0,message:"è¯·è¾“å…¥é‚®ç®±éªŒè¯ç "}],class:"code-item"},{default:r(()=>[t("div",Ce,[o(i,{value:s.email_code,"onUpdate:value":a[3]||(a[3]=l=>s.email_code=l),placeholder:"è¾“å…¥éªŒè¯ç ",size:"large"},null,8,["value"]),o(E,{type:"primary",class:"send-code-btn",disabled:g.value>0||!s.email,onClick:F,loading:R.value},{default:r(()=>[$(u(g.value>0?`${g.value}s`:"å‘é€éªŒè¯ç "),1)]),_:1},8,["disabled","loading"])])]),_:1})):V("",!0),o(w,{label:e.$t("auth.password"),name:"password",rules:[{required:!0,message:e.$t("validation.passwordRequired")}]},{default:r(()=>[o(z,{value:s.password,"onUpdate:value":a[4]||(a[4]=l=>s.password=l),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),o(w,{label:e.$t("auth.confirmPassword"),name:"re_password",rules:[{required:!0,message:e.$t("validation.passwordRequired")}]},{default:r(()=>[o(z,{value:s.re_password,"onUpdate:value":a[5]||(a[5]=l=>s.re_password=l),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),o(w,{label:e.$t("auth.inviteCode"),name:"invite_code"},{default:r(()=>[o(i,{value:s.invite_code,"onUpdate:value":a[6]||(a[6]=l=>s.invite_code=l),placeholder:e.$t("auth.inviteCode"),size:"large"},null,8,["value","placeholder"])]),_:1},8,["label"]),k(v).enableCaptcha?(m(),q(ne,{key:1,onVerify:B})):V("",!0),o(w,{name:"agreement",rules:[{validator:T}]},{default:r(()=>[o(O,{checked:s.agreement,"onUpdate:checked":a[7]||(a[7]=l=>s.agreement=l)},{default:r(()=>[$(u(e.$t("auth.agreement")),1)]),_:1},8,["checked"])]),_:1},8,["rules"]),o(E,{type:"primary","html-type":"submit",loading:I.value,block:"",size:"large"},{default:r(()=>[$(u(e.$t("auth.registerButton")),1)]),_:1},8,["loading"])]),_:1},8,["model"]),t("div",Se,[t("span",null,u(e.$t("auth.hasAccount")),1),o(M,{to:"/login",class:"link-primary"},{default:r(()=>[$(u(e.$t("auth.backToLogin")),1)]),_:1})])])])])])}}},Ee=D(xe,[["__scopeId","data-v-7751687a"]]);export{Ee as default};
