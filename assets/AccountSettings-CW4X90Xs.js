import{z as R,b as W,u as X,e as g,f as T,h as Q,i as y,j as s,l as r,k as u,t as a,p as w,G as $,I,a as U,w as N,m as B,S as x,s as O,O as Y,o as f,q as Z,P as ss}from"./index-BHTMErf9.js";import{g as es,H as ts,I as as,a as D,J as os,K as is,L as ns}from"./user-CAmOVogg.js";import{g as rs}from"./auth-Dz0LiSeU.js";import{S as ds}from"./settings-VMNCDt5-.js";import{L as ls}from"./lock-CS5XiEk9.js";import{C as cs}from"./circle-x-kmSNzzTN.js";import{C as A}from"./copy-Df0ta2DO.js";import"./request-BDShSQSj.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=R("key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),gs={class:"settings-page"},fs={class:"page-header"},ms={class:"header-icon"},_s={class:"settings-container"},ps={class:"settings-card glass-card"},hs={class:"card-title"},bs={class:"form-group"},vs={class:"form-group"},ys={class:"balance-display"},ws={class:"form-group"},Ss={class:"info-text"},ks={class:"settings-card glass-card"},$s={class:"card-title"},Is={class:"form-group"},Cs=["placeholder"],Ts={class:"form-group"},Us=["placeholder"],Ns={class:"form-group"},Bs=["placeholder"],Os=["disabled"],Ps={key:0,class:"settings-card glass-card"},Js={class:"card-header-with-action"},zs={class:"card-title"},Ms={class:"card-desc"},xs={key:0,class:"telegram-bind-section"},Ds={class:"info-row"},As={class:"label"},Vs={class:"value"},Ls={key:1,class:"telegram-unbind-section"},Fs={class:"info-row"},Es={class:"value"},js=["disabled"],Gs={key:2,class:"telegram-notifications mt-6 pt-6 border-t border-white/10"},qs={class:"text-sm font-semibold mb-4"},Ks={class:"notification-item"},Hs={class:"notification-info"},Rs={class:"notification-label"},Ws={class:"notification-item"},Xs={class:"notification-info"},Qs={class:"notification-label"},Ys={class:"modal-header-custom"},Zs={class:"header-icon-box"},se={class:"header-text-box"},ee={class:"text-xl font-bold mb-0"},te={class:"text-sm text-gray-400 mb-0"},ae={class:"modal-steps-container"},oe={class:"bind-step"},ie={class:"step-badge"},ne={class:"step-desc"},re={class:"copy-box"},de={class:"copy-text"},le={class:"copy-actions"},ce={class:"bind-step"},ue={class:"step-badge"},ge={class:"step-desc"},fe={class:"copy-box command-box"},me={class:"copy-text"},_e={class:"bind-tip"},pe={class:"tip-text"},he={class:"modal-custom-footer"},be={class:"settings-card glass-card"},ve={class:"card-title"},ye={class:"security-item"},we={class:"security-info"},Se={class:"security-icon"},ke={class:"security-info-text"},$e={class:"security-label"},Ie={class:"security-desc"},Ce=["disabled"],Te={class:"settings-card glass-card"},Ue={class:"notification-item"},Ne={class:"notification-item"},Be={class:"notification-item"},Oe={name:"UserSettings"},Pe=Object.assign(Oe,{setup(Je){const{t:d}=X(),C=g(!0),i=g({}),b=g(!1),v=g(!1),m=g({}),S=g(!1),_=g({}),k=g(!1),n=T({old_password:"",new_password:"",confirm_password:""}),l=T({remind_traffic:!1,remind_expire:!1}),p=T({order:!0,traffic:!0,system:!0});Q(async()=>{L(),V(),P(),F()});const V=async()=>{try{const e=localStorage.getItem("xboard_guest_config");if(e){const h=JSON.parse(e);C.value=!!h.is_telegram}const t=await rs();t.data&&(C.value=!!t.data.is_telegram,localStorage.setItem("xboard_guest_config",JSON.stringify(t.data)))}catch(e){console.error("Fetch guest config error:",e)}},L=()=>{try{const e=localStorage.getItem("xboard_user_info");if(e){const c=JSON.parse(e);i.value=c,l.remind_traffic=!!c.remind_traffic,l.remind_expire=!!c.remind_expire}const t=localStorage.getItem("xboard_bot_info");t&&(m.value=JSON.parse(t));const h=localStorage.getItem("xboard_subscribe_info");h&&(_.value=JSON.parse(h))}catch(e){console.error("Cache load error:",e)}},P=async()=>{try{const e=await es();e.data&&(i.value=e.data,l.remind_traffic=!!e.data.remind_traffic,l.remind_expire=!!e.data.remind_expire,localStorage.setItem("xboard_user_info",JSON.stringify(e.data)))}catch{}},F=async()=>{try{const e=await ts();e.data&&(m.value=e.data,localStorage.setItem("xboard_bot_info",JSON.stringify(e.data)))}catch{}},E=async()=>{if(S.value=!0,!_.value.subscribe_url)try{const e=await D();e.data&&(_.value=e.data,localStorage.setItem("xboard_subscribe_info",JSON.stringify(e.data)))}catch{}},J=()=>{m.value.username?window.open(`https://t.me/${m.value.username}`,"_blank"):AMessage.warning("Telegram bot info not available")},z=e=>{navigator.clipboard.writeText(e).then(()=>{AMessage.success(d("telegram.copySuccess"))})},j=async()=>{v.value=!0;try{if((await os()).data){AMessage.success(d("telegram.unBindSuccess"));const t={...i.value,telegram_id:null};i.value=t,localStorage.setItem("xboard_user_info",JSON.stringify(t)),P()}}catch{}finally{v.value=!1}},M=async()=>{try{const e={remind_traffic:l.remind_traffic?1:0,remind_expire:l.remind_expire?1:0};await ns(e);const t={...i.value,...e};i.value=t,localStorage.setItem("xboard_user_info",JSON.stringify(t)),O.success(d("telegram.switchSuccess"))}catch{}},G=e=>e?new Date(e*1e3).toLocaleDateString("zh-CN"):"--",q=async()=>{if(!n.old_password||!n.new_password||!n.confirm_password){AMessage.error(d("dashboard.settings.fillAllFields"));return}if(n.new_password!==n.confirm_password){AMessage.error(d("dashboard.settings.passwordMismatch"));return}b.value=!0;try{await as({old_password:n.old_password,new_password:n.new_password}),O.success(d("dashboard.settings.passwordChanged")),setTimeout(()=>{localStorage.removeItem("auth_token"),window.location.href="/#/login"},1500)}catch{}finally{b.value=!1}},K=()=>{Y.confirm({title:d("dashboard.settings.resetSecurity"),content:d("dashboard.settings.resetConfirm"),okText:d("dashboard.settings.resetSecurityBtn"),cancelText:d("common.cancel"),okType:"danger",centered:!0,async onOk(){k.value=!0;try{await is(),O.success(d("dashboard.settings.resetSuccess"));const e=await D();e.data&&(_.value=e.data,localStorage.setItem("xboard_subscribe_info",JSON.stringify(e.data)))}catch{}finally{k.value=!1}}})};return(e,t)=>{const h=B("a-tag"),c=B("a-switch"),H=B("a-modal");return f(),y("div",gs,[s("div",fs,[s("div",ms,[r(u(ds),{size:32})]),s("h1",null,a(e.$t("dashboard.settings.title")),1),s("p",null,a(e.$t("dashboard.settings.description")),1)]),s("div",_s,[s("div",ps,[s("h3",hs,a(e.$t("dashboard.settings.accountInfo")),1),s("div",bs,[s("label",null,a(e.$t("dashboard.settings.email")),1),$(s("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>i.value.email=o),disabled:"",class:"form-input"},null,512),[[I,i.value.email]])]),s("div",vs,[s("label",null,a(e.$t("dashboard.settings.balance")),1),s("div",ys," Â¥"+a(((i.value.balance||0)/100).toFixed(2)),1)]),s("div",ws,[s("label",null,a(e.$t("dashboard.settings.registerTime")),1),s("div",Ss,a(G(i.value.created_at)),1)])]),s("div",ks,[s("h3",$s,a(e.$t("dashboard.settings.changePassword")),1),s("div",Is,[s("label",null,a(e.$t("dashboard.settings.currentPassword")),1),$(s("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>n.old_password=o),type:"password",placeholder:e.$t("dashboard.settings.currentPasswordPlaceholder"),class:"form-input"},null,8,Cs),[[I,n.old_password]])]),s("div",Ts,[s("label",null,a(e.$t("dashboard.settings.newPassword")),1),$(s("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>n.new_password=o),type:"password",placeholder:e.$t("dashboard.settings.newPasswordPlaceholder"),class:"form-input"},null,8,Us),[[I,n.new_password]])]),s("div",Ns,[s("label",null,a(e.$t("dashboard.settings.confirmPassword")),1),$(s("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>n.confirm_password=o),type:"password",placeholder:e.$t("dashboard.settings.confirmPasswordPlaceholder"),class:"form-input"},null,8,Bs),[[I,n.confirm_password]])]),s("button",{class:"submit-btn",onClick:q,disabled:b.value},[b.value?w("",!0):(f(),U(u(ls),{key:0,size:18})),s("span",null,a(b.value?e.$t("dashboard.settings.changing"):e.$t("dashboard.settings.changePasswordBtn")),1)],8,Os)]),C.value?(f(),y("div",Ps,[s("div",Js,[s("h3",zs,a(e.$t("telegram.title")),1),i.value.telegram_id?(f(),U(h,{key:0,color:"success",class:"status-tag"},{default:N(()=>[Z(a(e.$t("telegram.bindingSuccess")),1)]),_:1})):w("",!0)]),s("p",Ms,a(e.$t("telegram.description")),1),i.value.telegram_id?(f(),y("div",Ls,[s("div",Fs,[t[13]||(t[13]=s("span",{class:"label"},"Telegram ID:",-1)),s("span",Es,a(i.value.telegram_id),1)]),s("button",{class:"unbind-btn",onClick:j,disabled:v.value},[v.value?w("",!0):(f(),U(u(cs),{key:0,size:18})),s("span",null,a(v.value?e.$t("telegram.unbinding"):e.$t("telegram.unBindBtn")),1)],8,js)])):(f(),y("div",xs,[s("div",Ds,[s("span",As,a(e.$t("telegram.botName"))+":",1),s("span",Vs,"@"+a(m.value.username||"Loading..."),1)]),s("button",{class:"telegram-btn",onClick:E},[r(u(x),{size:18}),s("span",null,a(e.$t("telegram.bindAccount")),1)])])),i.value.telegram_id?(f(),y("div",Gs,[s("h4",qs,a(e.$t("telegram.notifications")),1),s("div",Ks,[s("div",Hs,[s("div",Rs,a(e.$t("telegram.trafficWarning")),1)]),r(c,{checked:l.remind_traffic,"onUpdate:checked":t[4]||(t[4]=o=>l.remind_traffic=o),onChange:M},null,8,["checked"])]),s("div",Ws,[s("div",Xs,[s("div",Qs,a(e.$t("telegram.planExpire")),1)]),r(c,{checked:l.remind_expire,"onUpdate:checked":t[5]||(t[5]=o=>l.remind_expire=o),onChange:M},null,8,["checked"])])])):w("",!0)])):w("",!0),r(H,{open:S.value,"onUpdate:open":t[9]||(t[9]=o=>S.value=o),footer:null,closable:!0,width:460,centered:"",class:"telegram-bind-modal"},{title:N(()=>[s("div",Ys,[s("div",Zs,[r(u(x),{size:24,color:"#0088cc"})]),s("div",se,[s("h2",ee,a(e.$t("telegram.bindAccount")),1),s("p",te,a(e.$t("telegram.bindStepsTitle")),1)])])]),default:N(()=>[s("div",ae,[s("div",oe,[s("div",ie,a(e.$t("telegram.step1")),1),s("p",ne,a(e.$t("telegram.step1Desc")),1),s("div",re,[s("span",de,"@"+a(m.value.username),1),s("div",le,[r(u(A),{size:18,class:"copy-btn-icon",onClick:t[6]||(t[6]=o=>z(`@${m.value.username}`))}),r(u(ss),{size:18,class:"copy-btn-icon",onClick:J})])])]),s("div",ce,[s("div",ue,a(e.$t("telegram.step2")),1),s("p",ge,a(e.$t("telegram.step2Desc")),1),s("div",fe,[s("span",me,"/bind "+a(_.value.subscribe_url),1),r(u(A),{size:18,class:"copy-btn-icon",onClick:t[7]||(t[7]=o=>z(`/bind ${_.value.subscribe_url}`))})])]),s("div",_e,[t[14]||(t[14]=s("span",{class:"tip-icon"},"ðŸ’¡",-1)),s("span",pe,a(e.$t("telegram.tip"))+": "+a(e.$t("telegram.tipDesc")),1)])]),s("div",he,[s("button",{class:"footer-btn secondary",onClick:t[8]||(t[8]=o=>S.value=!1)},a(e.$t("telegram.close")),1),s("button",{class:"footer-btn primary",onClick:J},a(e.$t("telegram.openTelegram")),1)])]),_:1},8,["open"]),s("div",be,[s("h3",ve,a(e.$t("dashboard.settings.securitySettings")),1),s("div",ye,[s("div",we,[s("div",Se,[r(u(us),{size:20})]),s("div",ke,[s("div",$e,a(e.$t("dashboard.settings.resetSecurity")),1),s("div",Ie,a(e.$t("dashboard.settings.resetSecurityDesc")),1)])]),s("button",{class:"security-action",onClick:K,disabled:k.value},a(k.value?e.$t("dashboard.settings.reseting"):e.$t("dashboard.settings.resetSecurityBtn")),9,Ce)])]),s("div",Te,[t[18]||(t[18]=s("h3",{class:"card-title"},"é€šçŸ¥è®¾ç½®",-1)),s("div",Ue,[t[15]||(t[15]=s("div",{class:"notification-info"},[s("div",{class:"notification-label"},"è®¢å•é€šçŸ¥"),s("div",{class:"notification-desc"},"è®¢å•çŠ¶æ€å˜æ›´æ—¶é€šçŸ¥")],-1)),r(c,{checked:p.order,"onUpdate:checked":t[10]||(t[10]=o=>p.order=o)},null,8,["checked"])]),s("div",Ne,[t[16]||(t[16]=s("div",{class:"notification-info"},[s("div",{class:"notification-label"},"æµé‡æé†’"),s("div",{class:"notification-desc"},"æµé‡å³å°†ç”¨å°½æ—¶æé†’")],-1)),r(c,{checked:p.traffic,"onUpdate:checked":t[11]||(t[11]=o=>p.traffic=o)},null,8,["checked"])]),s("div",Be,[t[17]||(t[17]=s("div",{class:"notification-info"},[s("div",{class:"notification-label"},"ç³»ç»Ÿå…¬å‘Š"),s("div",{class:"notification-desc"},"æŽ¥æ”¶ç³»ç»Ÿé€šçŸ¥å’Œå…¬å‘Š")],-1)),r(c,{checked:p.system,"onUpdate:checked":t[12]||(t[12]=o=>p.system=o)},null,8,["checked"])])])])])}}}),Ee=W(Pe,[["__scopeId","data-v-715f6021"]]);export{Ee as default};
