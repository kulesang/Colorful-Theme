import{b as B,u as N,e as c,f as j,h as D,c as L,x as M,i as C,j as s,t as r,l as i,w as n,m as f,n as G,o as v,a as k,p as W,F as H,y as J,q as P,k as K,g as O,s as d}from"./index-BHTMErf9.js";import{g as Q,s as X,f as Y}from"./auth-Dz0LiSeU.js";import{C as Z}from"./Captcha-FofODmK4.js";import"./request-BDShSQSj.js";const ee={class:"dark-tech-auth"},ae={class:"auth-grid"},se={class:"branding-side"},te={class:"brand-content"},le={class:"logo-container"},oe={class:"brand-title"},ie={class:"brand-desc"},re={class:"features"},ne={class:"feature-badge"},ue={class:"feature-badge"},de={class:"form-side"},ce={class:"glass-card form-container"},fe={class:"form-header"},me={key:0,class:"email-whitelist-input"},ve={class:"code-input-group"},pe={class:"form-footer"},_e={href:"#/login",class:"link-primary"},he={__name:"ForgotPassword",setup(we){const{t:u}=N(),g=O(),A=G(),y=c(!1),o=c({}),_=c(null),E=e=>{_.value=e},l=j({email:"",password:"",re_password:"",email_code:""}),m=c(0),V=c(!1);let x=null;const R=async()=>{if(!l.email)return d.error(u("validation.emailRequired"));if(g.enableCaptcha&&_.value!==!0)return d.error(u("auth.enterCaptcha"));try{V.value=!0,await X({email:l.email,is_forget:1}),d.success(u("auth.codeSent")),m.value=60,x=setInterval(()=>{m.value--,m.value<=0&&clearInterval(x)},1e3)}catch(e){d.error(e.message||u("auth.sendFailed"))}finally{V.value=!1}};D(async()=>{try{const e=await Q();e.data&&(o.value=e.data,o.value.email_whitelist_suffix&&o.value.email_whitelist_suffix.length>0&&(p.value=o.value.email_whitelist_suffix[0]))}catch(e){console.error("Failed to fetch config:",e)}});const F=L(()=>o.value.email_whitelist_suffix&&Array.isArray(o.value.email_whitelist_suffix)&&o.value.email_whitelist_suffix.length>0),h=c(""),p=c("");M([h,p],()=>{F.value&&(l.email=`${h.value}@${p.value}`)});const U=async(e,a)=>{if(!a)throw new Error("è¯·è¾“å…¥é‚®ç®±");if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))throw new Error("è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€");if(o.value.email_whitelist_suffix&&Array.isArray(o.value.email_whitelist_suffix)){const b=a.split("@")[1];if(!o.value.email_whitelist_suffix.includes(b))throw new Error(`ä»…æ”¯æŒä»¥ä¸‹é‚®ç®±åŽç¼€: ${o.value.email_whitelist_suffix.join(", ")}`)}},I=async e=>{if(g.enableCaptcha){if(_.value===null)return d.error(u("auth.enterCaptcha"));if(_.value===!1)return d.error(u("auth.captchaInvalid"))}if(e.password!==e.re_password)return d.error(u("validation.passwordMismatch"));y.value=!0;try{(await Y(e)).data&&(d.success(u("auth.resetPasswordSuccess")),A.push("/login"))}catch{}finally{y.value=!1}};return(e,a)=>{const S=f("a-select-option"),b=f("a-select"),$=f("a-input"),w=f("a-form-item"),q=f("a-button"),z=f("a-input-password"),T=f("a-form");return v(),C("div",ee,[s("div",ae,[s("div",se,[s("div",te,[s("div",le,[a[6]||(a[6]=s("div",{class:"logo-glow"},null,-1)),s("h1",oe,r(e.$t("auth.forgotPasswordTitle")),1)]),s("p",ie,r(e.$t("auth.brandDesc")),1),s("div",re,[s("div",ne,[a[7]||(a[7]=s("div",{class:"badge-icon"},"ðŸ”’",-1)),s("span",null,r(e.$t("auth.secureVerification")),1)]),s("div",ue,[a[8]||(a[8]=s("div",{class:"badge-icon"},"ðŸ“§",-1)),s("span",null,r(e.$t("auth.emailVerification")),1)])])])]),s("div",de,[s("div",ce,[s("div",fe,[s("h2",null,r(e.$t("auth.forgotPasswordTitle")),1),s("p",null,r(e.$t("auth.forgotPasswordSubtitle")),1)]),i(T,{model:l,onFinish:I,layout:"vertical"},{default:n(()=>[i(w,{label:e.$t("auth.email"),name:"email",rules:[{validator:U}]},{default:n(()=>[F.value?(v(),C("div",me,[i($,{value:h.value,"onUpdate:value":a[1]||(a[1]=t=>h.value=t),placeholder:"example",size:"large"},{addonAfter:n(()=>[i(b,{value:p.value,"onUpdate:value":a[0]||(a[0]=t=>p.value=t),class:"suffix-select"},{default:n(()=>[(v(!0),C(H,null,J(o.value.email_whitelist_suffix,t=>(v(),k(S,{key:t,value:t},{default:n(()=>[P(" @"+r(t),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["value"])])):(v(),k($,{key:1,value:l.email,"onUpdate:value":a[2]||(a[2]=t=>l.email=t),placeholder:"your@email.com",size:"large"},null,8,["value"]))]),_:1},8,["label","rules"]),i(w,{label:"é‚®ç®±éªŒè¯ç ",name:"email_code",rules:[{required:!0,message:"è¯·è¾“å…¥é‚®ç®±éªŒè¯ç "}],class:"code-item"},{default:n(()=>[s("div",ve,[i($,{value:l.email_code,"onUpdate:value":a[3]||(a[3]=t=>l.email_code=t),placeholder:"è¾“å…¥éªŒè¯ç ",size:"large"},null,8,["value"]),i(q,{type:"primary",class:"send-code-btn",disabled:m.value>0||!l.email,onClick:R},{default:n(()=>[P(r(m.value>0?`${m.value}s`:"å‘é€éªŒè¯ç "),1)]),_:1},8,["disabled"])])]),_:1}),i(w,{label:e.$t("auth.newPassword"),name:"password",rules:[{required:!0,message:e.$t("validation.passwordRequired")},{min:6,message:"å¯†ç è‡³å°‘6ä½"}]},{default:n(()=>[i(z,{value:l.password,"onUpdate:value":a[4]||(a[4]=t=>l.password=t),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),i(w,{label:e.$t("auth.confirmPassword"),name:"re_password",rules:[{required:!0,message:e.$t("validation.passwordRequired")}]},{default:n(()=>[i(z,{value:l.re_password,"onUpdate:value":a[5]||(a[5]=t=>l.re_password=t),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",size:"large"},null,8,["value"])]),_:1},8,["label","rules"]),K(g).enableCaptcha?(v(),k(Z,{key:0,onVerify:E})):W("",!0),i(q,{type:"primary","html-type":"submit",loading:y.value,block:"",size:"large"},{default:n(()=>[P(r(e.$t("auth.resetPassword")),1)]),_:1},8,["loading"])]),_:1},8,["model"]),s("div",pe,[s("span",null,r(e.$t("auth.hasAccount")),1),s("a",_e,r(e.$t("auth.backToLogin")),1)])])])])])}}},Ce=B(he,[["__scopeId","data-v-fd97f60c"]]);export{Ce as default};
