import{u as j,r as f,a as U,o as H,c as y,b as s,e as r,d as c,t as a,k,B as S,G as I,j as N,w as T,f as B,m as p,i as u,l as W}from"./index.js";import{g as X,w as K,x as Q,a as R,y as Y,z as Z}from"./user.js";import{g as ss}from"./auth.js";import{_ as es}from"./_plugin-vue_export-helper.js";import{S as ts}from"./settings2.js";import{L as as}from"./lock.js";import{S as J}from"./send.js";import{C as os}from"./circle-x.js";import{C as V}from"./copy.js";import{c as is}from"./createLucideIcon.js";/**
 * @license lucide-vue-next v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=is("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),rs={class:"settings-page"},ds={class:"page-header"},ls={class:"header-icon"},cs={class:"settings-container"},us={class:"settings-card glass-card"},ms={class:"card-title"},fs={class:"form-group"},ps={class:"form-group"},gs={class:"balance-display"},_s={class:"form-group"},hs={class:"info-text"},bs={class:"settings-card glass-card"},vs={class:"card-title"},ws={class:"form-group"},ys=["placeholder"],ks={class:"form-group"},$s=["placeholder"],Ss={class:"form-group"},Is=["placeholder"],Cs=["disabled"],Us={key:0,class:"settings-card glass-card"},Ns={class:"card-header-with-action"},Ts={class:"card-title"},Bs={class:"card-desc"},Ps={key:0,class:"telegram-bind-section"},xs={class:"info-row"},Os={class:"label"},zs={class:"value"},Js={key:1,class:"telegram-unbind-section"},Vs={class:"info-row"},Ds={class:"value"},Ms=["disabled"],Ls={key:2,class:"telegram-notifications mt-6 pt-6 border-t border-white/10"},Fs={class:"text-sm font-semibold mb-4"},Es={class:"notification-item"},qs={class:"notification-info"},As={class:"notification-label"},Gs={class:"notification-item"},js={class:"notification-info"},Hs={class:"notification-label"},Ws={class:"modal-header-custom"},Xs={class:"header-icon-box"},Ks={class:"header-text-box"},Qs={class:"text-xl font-bold mb-0"},Rs={class:"text-sm text-gray-400 mb-0"},Ys={class:"modal-steps-container"},Zs={class:"bind-step"},se={class:"step-badge"},ee={class:"step-desc"},te={class:"copy-box"},ae={class:"copy-text"},oe={class:"copy-actions"},ie={class:"bind-step"},ne={class:"step-badge"},re={class:"step-desc"},de={class:"copy-box command-box"},le={class:"copy-text"},ce={class:"bind-tip"},ue={class:"tip-text"},me={class:"modal-custom-footer"},fe={class:"settings-card glass-card"},pe={class:"notification-item"},ge={class:"notification-item"},_e={class:"notification-item"},he={__name:"Settings",setup(be){const{t:g}=j(),C=f(!0),i=f({}),b=f(!1),v=f(!1),m=f({}),$=f(!1),w=f({}),n=U({old_password:"",new_password:"",confirm_password:""}),d=U({remind_traffic:!1,remind_expire:!1}),_=U({order:!0,traffic:!0,system:!0});H(async()=>{M(),D(),P(),L()});const D=async()=>{try{const e=localStorage.getItem("xboard_guest_config");if(e){const h=JSON.parse(e);C.value=!!h.is_telegram}const t=await ss();t.data&&(C.value=!!t.data.is_telegram,localStorage.setItem("xboard_guest_config",JSON.stringify(t.data)))}catch(e){console.error("Fetch guest config error:",e)}},M=()=>{try{const e=localStorage.getItem("xboard_user_info");if(e){const l=JSON.parse(e);i.value=l,d.remind_traffic=!!l.remind_traffic,d.remind_expire=!!l.remind_expire}const t=localStorage.getItem("xboard_bot_info");t&&(m.value=JSON.parse(t));const h=localStorage.getItem("xboard_subscribe_info");h&&(w.value=JSON.parse(h))}catch(e){console.error("Cache load error:",e)}},P=async()=>{try{const e=await X();e.data&&(i.value=e.data,d.remind_traffic=!!e.data.remind_traffic,d.remind_expire=!!e.data.remind_expire,localStorage.setItem("xboard_user_info",JSON.stringify(e.data)))}catch{}},L=async()=>{try{const e=await K();e.data&&(m.value=e.data,localStorage.setItem("xboard_bot_info",JSON.stringify(e.data)))}catch{}},F=async()=>{if($.value=!0,!w.value.subscribe_url)try{const e=await R();e.data&&(w.value=e.data,localStorage.setItem("xboard_subscribe_info",JSON.stringify(e.data)))}catch{}},x=()=>{m.value.username?window.open(`https://t.me/${m.value.username}`,"_blank"):p.warning("Telegram bot info not available")},O=e=>{navigator.clipboard.writeText(e).then(()=>{p.success(g("telegram.copySuccess"))})},E=async()=>{v.value=!0;try{if((await Y()).data){p.success(g("telegram.unBindSuccess"));const t={...i.value,telegram_id:null};i.value=t,localStorage.setItem("xboard_user_info",JSON.stringify(t)),P()}}catch{}finally{v.value=!1}},z=async()=>{try{const e={remind_traffic:d.remind_traffic?1:0,remind_expire:d.remind_expire?1:0};await Z(e);const t={...i.value,...e};i.value=t,localStorage.setItem("xboard_user_info",JSON.stringify(t)),p.success(g("telegram.switchSuccess"))}catch{}},q=e=>e?new Date(e*1e3).toLocaleDateString("zh-CN"):"--",A=async()=>{if(!n.old_password||!n.new_password||!n.confirm_password){p.error(g("dashboard.settings.fillAllFields"));return}if(n.new_password!==n.confirm_password){p.error(g("dashboard.settings.passwordMismatch"));return}b.value=!0;try{await Q({old_password:n.old_password,new_password:n.new_password}),p.success(g("dashboard.settings.passwordChanged")),setTimeout(()=>{localStorage.removeItem("auth_token"),window.location.href="/#/login"},1500)}catch{}finally{b.value=!1}};return(e,t)=>{const h=B("a-tag"),l=B("a-switch"),G=B("a-modal");return u(),y("div",rs,[s("div",ds,[s("div",ls,[r(c(ts),{size:32})]),s("h1",null,a(e.$t("dashboard.settings.title")),1),s("p",null,a(e.$t("dashboard.settings.description")),1)]),s("div",cs,[s("div",us,[s("h3",ms,a(e.$t("dashboard.settings.accountInfo")),1),s("div",fs,[s("label",null,a(e.$t("dashboard.settings.email")),1),S(s("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>i.value.email=o),disabled:"",class:"form-input"},null,512),[[I,i.value.email]])]),s("div",ps,[s("label",null,a(e.$t("dashboard.settings.balance")),1),s("div",gs," Â¥"+a(((i.value.balance||0)/100).toFixed(2)),1)]),s("div",_s,[s("label",null,a(e.$t("dashboard.settings.registerTime")),1),s("div",hs,a(q(i.value.created_at)),1)])]),s("div",bs,[s("h3",vs,a(e.$t("dashboard.settings.changePassword")),1),s("div",ws,[s("label",null,a(e.$t("dashboard.settings.currentPassword")),1),S(s("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>n.old_password=o),type:"password",placeholder:e.$t("dashboard.settings.currentPasswordPlaceholder"),class:"form-input"},null,8,ys),[[I,n.old_password]])]),s("div",ks,[s("label",null,a(e.$t("dashboard.settings.newPassword")),1),S(s("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>n.new_password=o),type:"password",placeholder:e.$t("dashboard.settings.newPasswordPlaceholder"),class:"form-input"},null,8,$s),[[I,n.new_password]])]),s("div",Ss,[s("label",null,a(e.$t("dashboard.settings.confirmPassword")),1),S(s("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>n.confirm_password=o),type:"password",placeholder:e.$t("dashboard.settings.confirmPasswordPlaceholder"),class:"form-input"},null,8,Is),[[I,n.confirm_password]])]),s("button",{class:"submit-btn",onClick:A,disabled:b.value},[b.value?k("",!0):(u(),N(c(as),{key:0,size:18})),s("span",null,a(b.value?e.$t("dashboard.settings.changing"):e.$t("dashboard.settings.changePasswordBtn")),1)],8,Cs)]),C.value?(u(),y("div",Us,[s("div",Ns,[s("h3",Ts,a(e.$t("telegram.title")),1),i.value.telegram_id?(u(),N(h,{key:0,color:"success",class:"status-tag"},{default:T(()=>[W(a(e.$t("telegram.bindingSuccess")),1)]),_:1})):k("",!0)]),s("p",Bs,a(e.$t("telegram.description")),1),i.value.telegram_id?(u(),y("div",Js,[s("div",Vs,[t[13]||(t[13]=s("span",{class:"label"},"Telegram ID:",-1)),s("span",Ds,a(i.value.telegram_id),1)]),s("button",{class:"unbind-btn",onClick:E,disabled:v.value},[v.value?k("",!0):(u(),N(c(os),{key:0,size:18})),s("span",null,a(v.value?e.$t("telegram.unbinding"):e.$t("telegram.unBindBtn")),1)],8,Ms)])):(u(),y("div",Ps,[s("div",xs,[s("span",Os,a(e.$t("telegram.botName"))+":",1),s("span",zs,"@"+a(m.value.username||"Loading..."),1)]),s("button",{class:"telegram-btn",onClick:F},[r(c(J),{size:18}),s("span",null,a(e.$t("telegram.bindAccount")),1)])])),i.value.telegram_id?(u(),y("div",Ls,[s("h4",Fs,a(e.$t("telegram.notifications")),1),s("div",Es,[s("div",qs,[s("div",As,a(e.$t("telegram.trafficWarning")),1)]),r(l,{checked:d.remind_traffic,"onUpdate:checked":t[4]||(t[4]=o=>d.remind_traffic=o),onChange:z},null,8,["checked"])]),s("div",Gs,[s("div",js,[s("div",Hs,a(e.$t("telegram.planExpire")),1)]),r(l,{checked:d.remind_expire,"onUpdate:checked":t[5]||(t[5]=o=>d.remind_expire=o),onChange:z},null,8,["checked"])])])):k("",!0)])):k("",!0),r(G,{visible:$.value,"onUpdate:visible":t[9]||(t[9]=o=>$.value=o),footer:null,closable:!0,width:460,centered:"",class:"telegram-bind-modal"},{title:T(()=>[s("div",Ws,[s("div",Xs,[r(c(J),{size:24,color:"#0088cc"})]),s("div",Ks,[s("h2",Qs,a(e.$t("telegram.bindAccount")),1),s("p",Rs,a(e.$t("telegram.bindStepsTitle")),1)])])]),default:T(()=>[s("div",Ys,[s("div",Zs,[s("div",se,a(e.$t("telegram.step1")),1),s("p",ee,a(e.$t("telegram.step1Desc")),1),s("div",te,[s("span",ae,"@"+a(m.value.username),1),s("div",oe,[r(c(V),{size:18,class:"copy-btn-icon",onClick:t[6]||(t[6]=o=>O(`@${m.value.username}`))}),r(c(ns),{size:18,class:"copy-btn-icon",onClick:x})])])]),s("div",ie,[s("div",ne,a(e.$t("telegram.step2")),1),s("p",re,a(e.$t("telegram.step2Desc")),1),s("div",de,[s("span",le,"/bind "+a(w.value.subscribe_url),1),r(c(V),{size:18,class:"copy-btn-icon",onClick:t[7]||(t[7]=o=>O(`/bind ${w.value.subscribe_url}`))})])]),s("div",ce,[t[14]||(t[14]=s("span",{class:"tip-icon"},"ðŸ’¡",-1)),s("span",ue,a(e.$t("telegram.tip"))+": "+a(e.$t("telegram.tipDesc")),1)])]),s("div",me,[s("button",{class:"footer-btn secondary",onClick:t[8]||(t[8]=o=>$.value=!1)},a(e.$t("telegram.close")),1),s("button",{class:"footer-btn primary",onClick:x},a(e.$t("telegram.openTelegram")),1)])]),_:1},8,["visible"]),s("div",fe,[t[18]||(t[18]=s("h3",{class:"card-title"},"é€šçŸ¥è®¾ç½®",-1)),s("div",pe,[t[15]||(t[15]=s("div",{class:"notification-info"},[s("div",{class:"notification-label"},"è®¢å•é€šçŸ¥"),s("div",{class:"notification-desc"},"è®¢å•çŠ¶æ€å˜æ›´æ—¶é€šçŸ¥")],-1)),r(l,{checked:_.order,"onUpdate:checked":t[10]||(t[10]=o=>_.order=o)},null,8,["checked"])]),s("div",ge,[t[16]||(t[16]=s("div",{class:"notification-info"},[s("div",{class:"notification-label"},"æµé‡æé†’"),s("div",{class:"notification-desc"},"æµé‡å³å°†ç”¨å°½æ—¶æé†’")],-1)),r(l,{checked:_.traffic,"onUpdate:checked":t[11]||(t[11]=o=>_.traffic=o)},null,8,["checked"])]),s("div",_e,[t[17]||(t[17]=s("div",{class:"notification-info"},[s("div",{class:"notification-label"},"ç³»ç»Ÿå…¬å‘Š"),s("div",{class:"notification-desc"},"æŽ¥æ”¶ç³»ç»Ÿé€šçŸ¥å’Œå…¬å‘Š")],-1)),r(l,{checked:_.system,"onUpdate:checked":t[12]||(t[12]=o=>_.system=o)},null,8,["checked"])])])])])}}},Te=es(he,[["__scopeId","data-v-d0acacce"]]);export{Te as default};
